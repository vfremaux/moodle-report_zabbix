define(["jquery","core_calendar/selectors","core_calendar/events","core/str","core/templates"],function(r,n,t,d,c){function i(e){e.on("click",n.eventFilterItem,function(e){var t,n,i=r(e.currentTarget);(n=o(t=i)).hidden=!n.hidden,d.get_string("eventtype"+n.eventtype,"calendar").then(function(e){return n.name=e,n}).then(function(e){return c.render("core_calendar/event_filter_key",e)}).then(function(e,n){return c.replaceNode(t,e,n)}).then(function(){a(n)}),e.preventDefault()}),r("body").on(t.viewUpdated,function(){e.find(n.eventFilterItem).each(function(e,n){(n=r(n)).data("eventtype-hidden")&&(n=o(n),a(n))})})}var a=function(e){M.util.js_pending("month-mini-filterChanged"),r("body").trigger(t.filterChanged,{type:e.eventtype,hidden:e.hidden}),M.util.js_complete("month-mini-filterChanged")},o=function(e){return{eventtype:e.data("eventtype"),hidden:e.data("eventtype-hidden")}};return{init:function(e){e=r(e),i(e)}}});