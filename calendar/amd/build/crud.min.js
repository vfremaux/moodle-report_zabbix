define(["jquery","core/str","core/notification","core/custom_interaction_events","core/modal","core/modal_registry","core/modal_factory","core/modal_events","core_calendar/modal_event_form","core_calendar/repository","core_calendar/events","core_calendar/modal_delete","core_calendar/selectors"],function(c,i,d,t,n,o,s,l,e,f,p,u,v){return{registerRemove:function(e){e.on("click",v.actions.remove,function(e){var n,o,t=c(this).closest(v.eventItem),a=t.data("eventId"),r=t.data("eventTitle"),t=t.data("eventCount");n=a,a=r,r=t,t=[{key:"deleteevent",component:"calendar"}],(r=(o=1<(r=parseInt(r,10)))?(t.push({key:"confirmeventseriesdelete",component:"calendar",param:{name:a,count:r}}),s.create({type:u.TYPE})):(t.push({key:"confirmeventdelete",component:"calendar",param:a}),s.create({type:s.types.SAVE_CANCEL}))).then(function(e){e.show()}).fail(d.exception),a=i.get_strings(t),c.when(a,r).then(function(e,t){return t.setTitle(e[0]),t.setBody(e[1]),o||t.setSaveButtonText(e[0]),t.getRoot().on(l.save,function(){f.deleteEvent(n,!1).then(function(){c("body").trigger(p.deleted,[n,!1])}).catch(d.exception)}),t.getRoot().on(p.deleteAll,function(){f.deleteEvent(n,!0).then(function(){c("body").trigger(p.deleted,[n,!0])}).catch(d.exception)}),t}).fail(d.exception),e.preventDefault()})},registerEditListeners:function(a,e){return e.then(function(o){c("body").on(p.editEvent,function(e,t){var n=a.find(v.wrapper);o.setEventId(t),o.setContextId(n.data("contextId")),o.show(),e.stopImmediatePropagation()})}).fail(d.exception),e},registerEventFormModal:function(a){var r=s.create({type:e.TYPE,large:!0});return a.on("click",v.actions.create,function(e){r.then(function(e){var t=a.find(v.wrapper),n=t.data("categoryid"),n=(void 0!==n&&e.setCategoryId(n),a.find(v.today)),o=a.find(v.day);!n.length&&o.length&&e.setStartTime(o.data("newEventTimestamp")),e.setContextId(t.data("contextId")),e.setCourseId(t.data("courseid")),e.show()}).fail(d.exception),e.preventDefault()}),a.on("click",v.actions.edit,function(t){t.preventDefault();var e=c(t.currentTarget),n=e.closest(v.wrapper),o=e.closest(v.eventItem);r.then(function(e){e.setEventId(o.data("eventId")),e.setContextId(n.data("contextId")),e.show(),t.stopImmediatePropagation()}).fail(d.exception)}),r}}});