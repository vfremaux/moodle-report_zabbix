define(["jquery","core/ajax","core/str","core/templates","core/notification","core/custom_interaction_events","core/modal_events","core/modal_factory","core_calendar/modal_event_form","core_calendar/summary_modal","core_calendar/repository","core_calendar/events","core_calendar/view_manager","core_calendar/crud","core_calendar/selectors"],function(d,e,n,i,c,t,a,o,r,h,l,s,u,f,v){function y(n){n.on("change",v.elements.courseSelector,function(){var e=d(this).val();u.reloadCurrentMonth(n,e,null).then(function(){return n.find(v.elements.courseSelector).val(e)}).fail(c.exception)});var e,t,a,r=f.registerEventFormModal(n),o=d(C).data("context-id");e=n,t=r,(a=d("body")).on(s.created,function(){u.reloadCurrentMonth(e)}),a.on(s.deleted,function(){u.reloadCurrentMonth(e)}),a.on(s.updated,function(){u.reloadCurrentMonth(e)}),a.on(s.editActionEvent,function(e,n){window.location.assign(n)}),a.on(s.moveEvent,w),a.on(s.eventMoved,function(){u.reloadCurrentMonth(e)}),f.registerEditListeners(e,t),o&&n.on("click",_,function(e){var a,o=d(e.target);o.is(g)||(a=d(this).attr("data-new-event-timestamp"),r.then(function(e){var n=o.closest(v.wrapper),t=(e.setCourseId(n.data("courseid")),n.data("categoryid"));void 0!==t&&e.setCategoryId(t),e.setContextId(n.data("contextId")),e.setStartTime(a),e.show()}).fail(c.exception),e.preventDefault())})}var _="[data-region='day']",m="[data-region='day-content']",p=".loading-icon",g="[data-action='view-day-link']",C=".calendarwrapper",w=function(e,n,t,a){var o=null,r=a.attr("data-day-timestamp");t&&(o=t.attr("data-day-timestamp")),t&&o==r||i.render("core/loading",{}).then(function(e,n){a.find(m).addClass("hidden"),i.appendNodeContents(a,e,n),t&&(t.find(m).addClass("hidden"),i.appendNodeContents(t,e,n))}).then(function(){return l.updateEventStartDay(n,r)}).then(function(){d("body").trigger(s.eventMoved,[n,t,a])}).always(function(){var e=a.find(p);a.find(m).removeClass("hidden"),i.replaceNode(e,"",""),t&&(e=t.find(p),t.find(m).removeClass("hidden"),i.replaceNode(e,"",""))}).fail(c.exception)};return{init:function(e){e=d(e),u.init(e),y(e)}}});