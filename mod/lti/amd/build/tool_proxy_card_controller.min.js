define(["jquery","core/ajax","core/notification","core/templates","mod_lti/tool_proxy","mod_lti/events","mod_lti/keys","core/str"],function(c,n,r,i,a,o,l,f){function t(e){e.removeClass("announcement loading success fail capabilities")}function d(i){var n=i.find(e.DELETE_BUTTON),t=(n.click(function(e){var n,t,o;e.preventDefault(),n=i,t=c.Deferred(),o=s(n),m(n),""===o?c.Deferred().resolve():f.get_strings([{key:"delete",component:"mod_lti"},{key:"delete_confirmation",component:"mod_lti"},{key:"delete",component:"mod_lti"},{key:"cancel",component:"core"}]).done(function(e){r.confirm(e[0],e[1],e[2],e[3],function(){a.delete(o).done(function(){u(n),T(n).done(function(){n.remove(),t.resolve()}).fail(r.exception)}).fail(function(e){y(n),t.reject(e)})},function(){u(n),t.resolve()})}).fail(function(e){u(n),r.exception(e),t.reject(e)})}),n.keypress(function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode!=l.ENTER&&e.keyCode!=l.SPACE||(e.preventDefault(),n.click())}),i.find(e.ACTIVATE_BUTTON));t.click(function(e){e.preventDefault();e=i;e={proxyid:s(i)},c(document).trigger(o.START_EXTERNAL_REGISTRATION,e)}),t.keypress(function(e){e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.keyCode!=l.ENTER&&e.keyCode!=l.SPACE||(e.preventDefault(),t.click())})}var e={DELETE_BUTTON:".delete",CAPABILITIES_CONTAINER:".capabilities-container",ACTIVATE_BUTTON:".tool-card-footer a.activate"},s=function(e){return e.attr("data-proxy-id")},m=function(e){t(e),e.addClass("announcement loading")},u=function(e){e.removeClass("announcement loading")},T=function(e){var n=c.Deferred();return t(e),e.addClass("announcement success"),setTimeout(function(){e.removeClass("announcement success"),n.resolve()},2e3),n},y=function(e){var n=c.Deferred();return t(e),e.addClass("announcement fail"),setTimeout(function(){e.removeClass("announcement fail"),n.resolve()},2e3),n};return{init:function(e){d(e)}}});