define(["jquery","core/ajax","core/notification","mod_lti/tool_type","mod_lti/events","mod_lti/keys","core/str"],function(n,u,i,o,c,r,T){function t(){return n(a.REGISTRATION_SUBMIT_BUTTON)}function e(){n(a.REGISTRATION_FORM).submit(function(t){var e,r;t.preventDefault(),d()||""!==(t=R())&&(g(),e=E(),r=_(),(t=o.create({cartridgeurl:t,key:e,secret:r})).done(function(){T.get_string("successfullycreatedtooltype","mod_lti").done(function(t){n(document).trigger(c.NEW_TOOL_TYPE),n(document).trigger(c.STOP_CARTRIDGE_REGISTRATION),n(document).trigger(c.REGISTRATION_FEEDBACK,{message:t})}).fail(i.exception)}).fail(function(){T.get_string("failedtocreatetooltype","mod_lti").done(function(t){n(document).trigger(c.NEW_TOOL_TYPE),n(document).trigger(c.STOP_CARTRIDGE_REGISTRATION),n(document).trigger(c.REGISTRATION_FEEDBACK,{message:t,error:!0})}).fail(i.exception)}).always(function(){l()}))});var e=n(a.REGISTRATION_CANCEL_BUTTON);e.click(function(t){t.preventDefault(),n(document).trigger(c.STOP_CARTRIDGE_REGISTRATION)}),e.keypress(function(t){t.metaKey||t.shiftKey||t.altKey||t.ctrlKey||t.keyCode!=r.ENTER&&t.keyCode!=r.SPACE||(t.preventDefault(),e.click())})}var a={CARTRIDGE_URL:"#cartridge-url",CONSUMER_KEY:"#registration-key",SHARED_SECRET:"#registration-secret",REGISTRATION_FORM:"#cartridge-registration-form",REGISTRATION_SUBMIT_BUTTON:"#cartridge-registration-submit",REGISTRATION_CANCEL_BUTTON:"#cartridge-registration-cancel"},R=function(){return n(a.REGISTRATION_FORM).attr("data-cartridge-url")},E=function(){return n(a.CONSUMER_KEY).val()},_=function(){return n(a.SHARED_SECRET).val()},g=function(){t().addClass("loading")},l=function(){t().removeClass("loading")},d=function(){return t().hasClass("loading")};return{init:function(){e()}}});