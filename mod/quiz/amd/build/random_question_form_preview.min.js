define(["jquery","core/ajax","core/str","core/notification","core/templates","core/paged_content_factory"],function(f,a,r,_,N,m){function n(n){n.find(i.LOADING_ICON_CONTAINER).removeClass("hidden")}function e(n){n.find(i.LOADING_ICON_CONTAINER).addClass("hidden")}var l=5,I="mod_quiz/random_question_form_preview_question_list",i={LOADING_ICON_CONTAINER:'[data-region="overlay-icon-container"]',QUESTION_COUNT_CONTAINER:'[data-region="question-count-container"]',QUESTION_LIST_CONTAINER:'[data-region="question-list-container"]'},O=function(n,e,t,o,i,r){return a.call([{methodname:"core_question_get_random_question_summaries",args:{categoryid:n,includesubcategories:e,tagids:t,contextid:o,limit:i,offset:r}}])[0]};return{reload:function(o,c,u,s,d){return n(o),O(c,u,s,d,l,0).then(function(n){var e,t=n.totalcount;return e=o,r.get_string("questionsmatchingfilter","mod_quiz",t).then(function(n){e.find(i.QUESTION_COUNT_CONTAINER).html(n)}).fail(_.exception),n}).then(function(n){var t,o,i,r,a,e=n.totalcount,n=n.questions;return n.length?(t=c,o=u,i=s,r=d,a=n,m.createFromAjax(e,l,function(n){return n.map(function(n){var e=n.limit,n=n.offset;return 0==n?N.render(I,{questions:a}):O(t,o,i,r,e,n).then(function(n){n=n.questions;return N.render(I,{questions:n})}).fail(_.exception)})})):f.Deferred().resolve("","")}).then(function(n,e){var t=o.find(i.QUESTION_LIST_CONTAINER);N.replaceNodeContents(t,n,e)}).always(function(){e(o)}).fail(_.exception)},showLoadingIcon:n,hideLoadingIcon:e}});