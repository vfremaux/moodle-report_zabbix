define(["jquery","mod_quiz/random_question_form_preview"],function(u,_){function t(n){return n.find(i.CATEGORY_FORM_ELEMENT).val()}var c=2e3,i={PREVIEW_CONTAINER:'[data-region="random-question-preview-container"]',CATEGORY_FORM_ELEMENT:'[name="category"]',SUBCATEGORY_FORM_ELEMENT:'[name="includesubcategories"]',TAG_IDS_FORM_ELEMENT:'[name="fromtags[]"]'},o=function(n){return t(n).split(",")[0]},r=function(n,e){return!!function(n,e){n=t(n);return-1<e.indexOf(n)}(n,e)||n.find(i.SUBCATEGORY_FORM_ELEMENT).is(":checked")},a=function(n){return n.find(i.TAG_IDS_FORM_ELEMENT).val().map(function(n){return n.split(",")[0]})},T=function(n,e,t){var E=n.find(i.PREVIEW_CONTAINER);_.reload(E,o(n),r(n,t),a(n),e)},f=function(n){return 0<n.closest(i.CATEGORY_FORM_ELEMENT).length||(0<n.closest(i.SUBCATEGORY_FORM_ELEMENT).length||0<n.closest(i.TAG_IDS_FORM_ELEMENT).length)};return{init:function(n,e,t){var E,i,o,r,n=u("#"+n);T(n,e,t),i=e,o=t,r=null,(E=n).on("change",function(n){f(u(n.target))&&(_.showLoadingIcon(E),r&&clearTimeout(r),r=setTimeout(function(){T(E,i,o)},c))})}}});