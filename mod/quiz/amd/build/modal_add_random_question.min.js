define(["jquery","core/yui","core/notification","core/modal","core/modal_events","core/modal_registry","core/fragment","core/templates"],function(d,t,e,o,u,n,r,a){function i(t){o.call(this,t),this.contextId=null,this.addOnPageId=null,this.category=null,this.returnUrl=null,this.cmid=null,this.loadedForm=!1}var l='[data-region="existing-category-container"]',p="#id_existingcategoryheader",m='[data-region="new-category-container"]',g="#id_newcategoryheader",s='[data-region="tab-content"]',h='[name="addonpage"]',f='input[type="submit"]',y='input[type="submit"][name="cancel"]',I="legend",c=".fitem";return i.TYPE="mod_quiz-quiz-add-random-question",((i.prototype=Object.create(o.prototype)).constructor=i).prototype.setContextId=function(t){this.contextId=t},i.prototype.getContextId=function(){return this.contextId},i.prototype.setAddOnPageId=function(t){this.addOnPageId=t,this.getBody().find(h).val(t)},i.prototype.getAddOnPageId=function(){return this.addOnPageId},i.prototype.setCategory=function(t){this.category=t},i.prototype.getCategory=function(){return this.category},i.prototype.setReturnUrl=function(t){this.returnUrl=t},i.prototype.getReturnUrl=function(){return this.returnUrl},i.prototype.setCMID=function(t){this.cmid=t},i.prototype.getCMID=function(){return this.cmid},i.prototype.moveFormElementIntoTab=function(t,e){var o=t.find(f),n=d('<div class="modal-footer m-t-1" data-region="footer"></div>');t.find(I).addClass("hidden"),t.wrap(e),o.closest(c).remove(),o.appendTo(n),n.appendTo(t)},i.prototype.moveTabsIntoTabContent=function(t){var e=this.getBody().find(s).empty();t.find('[role="tabpanel"]').wrapAll(e)},i.prototype.moveCancelButtonToTabs=function(t){var e=t.find(y).addClass("m-l-1"),t=t.find('[data-region="footer"]');e.closest(c).remove(),e.clone().appendTo(t)},i.prototype.loadForm=function(){return r.loadFragment("mod_quiz","add_random_question_form",this.getContextId(),{addonpage:this.getAddOnPageId(),cat:this.getCategory(),returnurl:this.getReturnUrl(),cmid:this.getCMID()}).then(function(t,e){var t=d(t),o=t.find(p),n=this.getBody().find(l),r=t.find(g),i=this.getBody().find(m);this.moveFormElementIntoTab(o,n),this.moveFormElementIntoTab(r,i),this.moveTabsIntoTabContent(t),this.moveCancelButtonToTabs(t),a.replaceNode(this.getBody().find(s),t,e)}.bind(this)).then(function(){t.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()})}).fail(e.exception)},i.prototype.show=function(){o.prototype.show.call(this),this.loadedForm||(this.loadForm(),this.loadedForm=!0)},n.register(i.TYPE,i,"mod_quiz/modal_add_random_question"),i});