define(["jquery","core/yui","core/notification","core/modal","core/modal_events","core/modal_registry","core/fragment"],function(o,t,e,n,i,r,a){function s(t){n.call(this,t),this.contextId=null,this.addOnPageId=null}var d="td.addtoquizaction",p="a[href]",l="td.previewaction",h="#advancedsearch",c="#displayoptions";return s.TYPE="mod_quiz-quiz-question-bank",((s.prototype=Object.create(n.prototype)).constructor=s).prototype.setContextId=function(t){this.contextId=t},s.prototype.getContextId=function(){return this.contextId},s.prototype.setAddOnPageId=function(t){this.addOnPageId=t},s.prototype.getAddOnPageId=function(){return this.addOnPageId},s.prototype.show=function(){return this.reloadBodyContent(window.location.search),n.prototype.show.call(this)},s.prototype.reloadBodyContent=function(t){t=a.loadFragment("mod_quiz","quiz_question_bank",this.getContextId(),{querystring:t}).fail(e.exception);this.setBody(t)},s.prototype.handleAddToQuizEvent=function(t,e){var o=e.attr("href")+"&addonpage="+this.getAddOnPageId();e.attr("href",o)},s.prototype.handlePreviewContainerEvent=function(t,e){window.openpopup(t,{url:e.attr("href"),name:"questionpreview",options:["height=600","width=800","top=0","left=0","menubar=0","location=0","scrollbars","resizable","toolbar","status","directories=0","fullscreen=0","dependent"].join(",")})},s.prototype.handleDisplayOptionFormEvent=function(t){t.stopPropagation(),t.preventDefault();t="?"+o(t.target).closest(c).serialize();this.reloadBodyContent(t)},s.prototype.registerDisplayOptionListeners=function(){this.getModal().on("change",c,function(t){o(t.target).attr("aria-autocomplete")||this.handleDisplayOptionFormEvent(t)}.bind(this)),this.getModal().on("submit",c,function(t){this.handleDisplayOptionFormEvent(t)}.bind(this))},s.prototype.registerEventListeners=function(){n.prototype.registerEventListeners.call(this),this.registerDisplayOptionListeners(),this.getModal().on("click",p,function(t){var e=o(t.currentTarget);e.closest(d).length?this.handleAddToQuizEvent(t,e):e.closest(l).length?this.handlePreviewContainerEvent(t,e):e.closest(h).length||(t.preventDefault(),this.reloadBodyContent(e.prop("search")))}.bind(this)),this.getRoot().on(i.bodyRendered,function(){t.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()})})},r.register(s.TYPE,s,"core/modal"),s});