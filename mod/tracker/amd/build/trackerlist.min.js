define(["jquery","core/config","core/log","mod_tracker/bootstrap-select"],function(a,r,t,e){var d={init:function(){a(".tracker-issue-edit-handle").bind("click",this.load_change_form),a("#modal-status-save").bind("click",this.submit_change_form),a(".tracker-quick-solve-buttons").bind("click",this.solve_issue),a("#tracker-quick-find-input").bind("change",this.quick_find),t.debug("AMD Tracker List initialized")},load_change_form:function(){var t=a(this),e='<div class="centered"><center><img id="detail-waiter" src="',s=(e+=r.wwwroot+'/pix/i/ajaxloader.gif" /></center></div>',a("#issuelist-edit-inner-form").html(e),t.attr("id").replace(/issue-edit-(.*?)-handle-/,"")),i=t.attr("data-mode"),e=t.attr("data-context"),t=r.wwwroot+"/mod/tracker/ajax/service.php";a.get(t+"?what=getmodalform"+("&mode="+i)+("&id="+s)+("&ctx="+e),function(t){a("#issuelist-edit-inner-form").html(t),a("#modal-status-save").attr("data-issue",s),a("#modal-status-save").attr("data-purpose",i),a(".selectpicker").selectpicker()},"html")},submit_change_form:function(){var t=a(this),s=t.attr("data-issue"),i=t.attr("data-purpose"),t=(t=(t=r.wwwroot+"/mod/tracker/ajax/service.php")+("?what=update"+i)+("&id="+s))+("&"+i+"="+a("#"+i+"-select-"+s).val());a.get(t,function(t){var e;"success"===t.result&&("status"==i&&(e="status-"+d.get_status_code(t.oldvalue),a(".issue-list-status-"+s).removeClass(e),e="status-"+d.get_status_code(t.newvalue),a(".issue-list-status-"+s).addClass(e)),a("#tracker-"+i+"-"+s).html(t.newlabel),a("#issuelist-edit-form").modal("hide"))},"json")},get_status_code:function(t){return["posted","open","resolving","waiting","resolved","abandonned","transfered","testing","validated","published"][t]},solve_issue:function(){var t=a(this),e=t.attr("id").replace("resolve-",""),t=t.attr("data-cmid"),t=r.wwwroot+"/mod/tracker/view.php?id="+t,t=(t=(t+="&view=view")+"&screen=mytickets"+"&what=solve")+("&issueid="+e)+("&sesskey="+r.sesskey);window.location=t},quick_find:function(){a("#id-quick-find-form").submit()}};return d});