define(["core/templates","jquery","core/str","core/config","core/notification","core/modal_factory","core/modal_events","core/fragment"],function(t,n,o,e,i,r,a,s){function c(t){this.contextid=t.contextid,this.initModal()}var l="#id_cohortlist",u=".enrolusersbutton.enrol_manual_plugin [type='submit']",d=":input[value='_qf__force_multiselect_submission']";return c.prototype.courseid=0,c.prototype.modal=null,c.prototype.initModal=function(){var t=n(u);n.when(o.get_strings([{key:"enroluserscohorts",component:"enrol_manual"},{key:"enrolusers",component:"enrol_manual"}]),r.create({type:r.types.SAVE_CANCEL,large:!0},t)).then(function(o,e){(this.modal=e).setTitle(o[1]),e.setSaveButtonText(o[1]),e.getRoot().on(a.save,this.submitForm.bind(this)),e.getRoot().on("submit","form",this.submitFormAjax.bind(this)),e.getRoot().on(a.hidden,function(){e.setBody("")}),e.getRoot().on(a.shown,function(){var t=this.getBody();t.then(function(t){t=n(t).find(l).length?0:1;e.setSaveButtonText(o[t])}).fail(i.exception),e.setBody(t)}.bind(this))}.bind(this)).fail(i.exception)},c.prototype.submitForm=function(t){t.preventDefault(),this.modal.getRoot().find("form").submit()},c.prototype.submitFormAjax=function(t){t.preventDefault();t=this.modal.getRoot().find("form"),t.find(d).each(function(){n(this).remove()}),t=t.serialize(),this.modal.hide(),t=e.wwwroot+"/enrol/manual/ajax.php?"+t;n.ajax(t,{type:"GET",processData:!1,contentType:"application/json"}).then(function(t){t.error?i.addNotification({message:t.error,type:"error"}):(void 0!==window.M.core_formchangechecker&&window.M.core_formchangechecker.reset_form_dirty_state(),window.location.reload())}).fail(i.exception)},c.prototype.getBody=function(){return s.loadFragment("enrol_manual","enrol_users_form",this.contextid,{}).fail(i.exception)},c.prototype.getFooter=function(){return t.render("enrol_manual/enrol_modal_footer",{})},{init:function(t){new c(t)}}});