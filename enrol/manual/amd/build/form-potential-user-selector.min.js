define(["jquery","core/ajax","core/templates","core/str"],function(i,s,u,c){return{processResults:function(e,n){var r=[];return i.isArray(n)?(i.each(n,function(e,n){r.push({value:n.id,label:n._label})}),r):n},transport:function(e,n,a,r){var t=i(e).attr("courseid"),o=i(e).attr("userfields").split(","),e=(void 0===t&&(t="1"),i(e).attr("enrolid"));s.call([{methodname:"core_enrol_get_potential_users",args:{courseid:t,enrolid:e=void 0===e?"":e,search:n,searchanywhere:!0,page:0,perpage:101}}])[0].then(function(e){var n=[],t=0;return e.length<=100?(i.each(e,function(e,r){var t=r,a=[];i.each(o,function(e,n){void 0!==r[n]&&""!==r[n]&&(t.hasidentity=!0,a.push(r[n]))}),t.identity=a.join(", "),n.push(u.render("enrol_manual/form-user-selector-suggestion",t))}),i.when.apply(i.when,n).then(function(){var r=arguments;i.each(e,function(e,n){n._label=r[t],t++}),a(e)})):c.get_string("toomanyuserstoshow","core",">100").then(function(e){a(e)})}).fail(r)}}});