define(["jquery","core/log","core/config","block_auditquiz_results/html2canvas"],function(n,d,o,u){return{init:function(){n(".auditquiz-results-unbind").bind("click",this.unbind_course),n(".auditquiz-snapshot-btn").bind("click",this.send_image),n(".auditquiz-snapshots").on("click",".auditquiz-snapshot-delete-btn","",this.delete_image),n(".user-sort").bind("click",[],this.change_user_sorting),d.debug("AMD Auditquiz results initialized")},unbind_course:function(t){t.preventDefault();var t=n(this).attr("id").split("-"),i=t[1],a=t[2],s=t[3],t=o.wwwroot+"/blocks/auditquiz_results/ajax/service.php";n.get(t+"?what=unbind"+("&blockid="+i)+("&qcatid="+a)+("&courseid="+s),function(){n("#id-coursebinding-"+a+"-"+s).css("display","none")},"html")},send_image:function(){var t=n(this),i=t.attr("id"),a=t.attr("data-blockid"),s=t.attr("data-itemid"),e=t.attr("data-type"),t=i.replace("snapshot-","");u(document.querySelector("#"+t)).then(function(t){var i=o.wwwroot+"/blocks/auditquiz_results/ajax/service.php";d.debug("url set "),canvascontent=t.toDataURL(),data={what:"addsnapshot",blockid:a,itemid:s,snaptype:e,imagedata:canvascontent},n.post(i,data,function(t){n("#id-auditquiz-snapshots-container-"+s+"-"+a).html(t),n("#id-auditquiz-snapshots-container-"+s+"-"+a).css("display","block")},"html")})},delete_image:function(){var t=n(this),i=t.attr("data-fileid"),a=t.attr("data-itemid"),s=t.attr("data-type"),e=t.attr("data-blockid"),t=o.wwwroot+"/blocks/auditquiz_results/ajax/service.php";data={what:"deletesnapshot",snapshotid:i,blockid:e,itemid:a,snaptype:s},n.post(t,data,function(t){n("#id-auditquiz-snapshots-container-"+a+"-"+e).html(t)},"html")},change_user_sorting:function(){var t=n(this),i=t.attr("data-sort"),a=t.attr("data-blockid"),s=t.attr("data-courseid"),t=t.attr("data-view"),e=(e=(e=o.wwwroot+"/blocks/auditquiz_results/coursereport.php")+("?view="+t)+("&blockid="+a))+("&id="+s)+("&sort="+i);window.location.href=e}}});