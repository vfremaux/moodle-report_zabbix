define(["jquery","core/str","block_timeline/event_list","core/pubsub","core/paged_content_events"],function(r,c,s,n,i){function t(e){var t=e.find(o.EVENT_LIST_CONTAINER),n=r(t).attr("id")+"user_block_timeline"+Math.random(),i=(_(e,n),u(e)),a={persistentLimitKey:"block_timeline_user_limit_preference",eventNamespace:n};c.get_string("ariaeventlistpaginationnavdates","block_timeline").then(function(e){return s.init(t,i,{},e,a),e}).catch(function(){s.init(t,i,{},"",a)})}var o={EVENT_LIST_CONTAINER:'[data-region="event-list-container"]'},a=[5,10,25],u=function(e){var t=parseInt(e.data("limit"),10),n=!1,e=a.map(function(e){return t==e&&(n=!0),{value:e,active:t==e}});return n||(e[0].active=!0),e},_=function(t,e){e+=i.SET_ITEMS_PER_PAGE_LIMIT;n.subscribe(e,function(e){r(t).data("limit",e)})};return{init:function(e){(e=r(e)).hasClass("active")&&(t(e),e.data("seen",!0))},reset:function(e){e.removeAttr("data-seen"),e.hasClass("active")&&(t(e),e.data("seen",!0))},shown:function(e){e.data("seen")||(t(e),e.data("seen",!0))}}});