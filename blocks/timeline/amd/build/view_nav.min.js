define(["jquery","core/custom_interaction_events","block_timeline/view","core/ajax","core/notification"],function(o,_,s,a,n){var c={TIMELINE_DAY_FILTER:'[data-region="day-filter"]',TIMELINE_DAY_FILTER_OPTION:"[data-from]",TIMELINE_VIEW_SELECTOR:'[data-region="view-selector"]',DATA_DAYS_OFFSET:"[data-days-offset]",DATA_DAYS_LIMIT:"[data-days-limit]"},f=function(e,t){a.call([{methodname:"core_user_update_user_preferences",args:{preferences:[{type:e,value:t}]}}])[0].fail(n.exception)};return{init:function(e,t){e=o(e),i=t,a=(r=e).find(c.TIMELINE_DAY_FILTER),_.define(a,[_.events.activate]),a.on(_.events.activate,c.TIMELINE_DAY_FILTER_OPTION,function(e,t){var a,n=o(e.currentTarget).data("filtername"),n=(f("block_timeline_user_filter_preference",n),o(e.target).closest(c.TIMELINE_DAY_FILTER_OPTION));n.hasClass("active")||(e=n.attr("data-from"),n=n.attr("data-to"),(a=r.find(c.DATA_DAYS_OFFSET)).attr("data-days-offset",e),null!=n?a.attr("data-days-limit",n):a.removeAttr("data-days-limit"),s.reset(i),t.originalEvent.preventDefault())});var r,i,a=e,n=t;(a=a.find(c.TIMELINE_VIEW_SELECTOR)).on("shown shown.bs.tab",function(){s.shown(n)}),_.define(a,[_.events.activate]),a.on(_.events.activate,"[data-toggle='tab']",function(e){e=o(e.currentTarget).data("filtername");f("block_timeline_user_sort_preference",e)})}}});