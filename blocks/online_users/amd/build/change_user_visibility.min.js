define(["jquery","core/ajax","core/str","core/notification"],function(r,t,n,c){function i(a,e){t.call([{methodname:"core_user_set_user_preferences",args:{preferences:[{name:"block_online_users_uservisibility",value:"show"==a?1:0,userid:e}]}}])[0].then(function(e){var t,n,i;e.saved&&(e=o(a),I(i=e).then(function(e){r(s.CHANGE_VISIBILITY_LINK).attr({"data-action":i,title:e})}).catch(c.exception),t=e,n=r(s.CHANGE_VISIBILITY_ICON),I(t).then(function(e){r(n).attr({title:e,"aria-label":e}),n.is("img")?r(n).attr({src:M.util.image_url("t/"+t),alt:e}):(r(n).addClass(u(t)),r(n).removeClass(u(o(t))))}).catch(c.exception))}).catch(c.exception)}var s={CHANGE_VISIBILITY_LINK:"#change-user-visibility",CHANGE_VISIBILITY_ICON:"#change-user-visibility .icon"},o=function(e){return"show"==e?"hide":"show"},u=function(e){return"show"==e?"fa-eye-slash":"fa-eye"},I=function(e){return n.get_string("online_status:"+e,"block_online_users")};return{init:function(){r(s.CHANGE_VISIBILITY_LINK).on("click",function(e){e.preventDefault();var e=r(this).attr("data-action"),t=r(this).attr("data-userid");i(e,t)})}}});