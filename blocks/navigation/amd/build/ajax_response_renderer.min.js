define(["jquery","core/templates","core/notification","core/url"],function(s,p,h,m){var u=40,y=50;return{render:function(a,e){var t;e.children&&e.children.length?(function c(a,e){var l=s("<ul></ul>"),e=(l.attr("role","group"),l.attr("aria-hidden",!0),s.each(e,function(a,e){var t,n,r,i,d,o;"object"==typeof e&&(t=s("<li></li>"),n=s("<p></p>"),o=e.id||e.key+"_tree_item",r=null,i=!(!e.expandable&&!e.haschildren),n.addClass("tree_item"),n.attr("id",o),n.attr("role","treeitem"),n.attr("tabindex","-1"),e.requiresajaxloading&&(n.attr("data-requires-ajax",!0),n.attr("data-node-id",e.id),n.attr("data-node-key",e.key),n.attr("data-node-type",e.type)),i&&(t.addClass("collapsed contains_branch"),n.attr("aria-expanded",!1),n.addClass("branch")),d=null,o=e.link?s('<a title="'+e.title+'" href="'+e.link+'"></a>'):s("<span></span>"),(d=o).append('<span class="item-content-wrap">'+e.name+"</span>"),e.hidden&&o.addClass("dimmed"),n.append(o),!e.icon||i&&e.type!==u&&e.type!==y||(t.addClass("item_with_icon"),n.addClass("hasicon"),e.type===u||e.type===y?((r=s("<img/>")).attr("alt",e.icon.alt),r.attr("title",e.icon.title),r.attr("src",m.imageUrl(e.icon.pix,e.icon.component)),s.each(e.icon.classes,function(a,e){r.addClass(e)}),d.prepend(r)):("moodle"==e.icon.component&&(e.icon.component="core"),p.renderPix(e.icon.pix,e.icon.component,e.icon.title).then(function(a){d.prepend(a)}).catch(h.exception))),t.append(n),l.append(t),e.children&&e.children.length?c(n,e.children):i&&!e.requiresajaxloading&&(t.removeClass("contains_branch"),n.addClass("emptybranch")))}),a.parent().append(l),a.attr("id")+"_group");l.attr("id",e),a.attr("aria-owns",e),a.attr("role","treeitem")}(a,e.children),e=a.children("[role='treeitem']").first(),t=a.find("#"+e.attr("aria-owns")),e.attr("aria-expanded",!0),t.attr("aria-hidden",!1)):a.parent().hasClass("contains_branch")&&(a.parent().removeClass("contains_branch"),a.addClass("emptybranch"))}}});