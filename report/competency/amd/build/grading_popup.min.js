define(["jquery","core/notification","core/str","core/ajax","core/log","core/templates","tool_lp/dialogue"],function(r,n,c,i,d,s,a){function e(e,o){this._regionSelector=e,this._userCompetencySelector=o,r(this._regionSelector).on("click",this._userCompetencySelector,this._handleClick.bind(this))}return e.prototype._handleClick=function(e){var e=r(e.target).closest(this._userCompetencySelector),o=r(e).data("competencyid"),t=r(e).data("courseid"),e=r(e).data("userid"),e=(d.debug("Clicked on cell: competencyId="+o+", courseId="+t+", userId="+e),i.call([{methodname:"tool_lp_data_for_user_competency_summary_in_course",args:{userid:e,competencyid:o,courseid:t}},{methodname:"core_competency_user_competency_viewed_in_course",args:{userid:e,competencyid:o,courseid:t}}]));r.when.apply(r,e).then(function(e){this._contextLoaded.bind(this)(e)}.bind(this)).catch(n.exception)},e.prototype._contextLoaded=function(e){var r=this;e.displayuser=!0,s.render("tool_lp/user_competency_summary_in_course",e).done(function(o,t){c.get_string("usercompetencysummary","report_competency").done(function(e){new a(e,o,s.runTemplateJS.bind(s,t),r._refresh.bind(r),!0)}).fail(n.exception)}).fail(n.exception)},e.prototype._refresh=function(){var e=r(this._regionSelector),o=e.data("courseid"),e=e.data("userid");i.call([{methodname:"report_competency_data_for_report",args:{courseid:o,userid:e},done:this._pageContextLoaded.bind(this),fail:n.exception}])},e.prototype._pageContextLoaded=function(e){var t=this;s.render("report_competency/report",e).done(function(e,o){s.replaceNode(t._regionSelector,e,o)}).fail(n.exception)},e.prototype._regionSelector=null,e.prototype._userCompetencySelector=null,e});