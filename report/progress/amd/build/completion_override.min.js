define(["jquery","core/ajax","core/str","core/modal_factory","core/modal_events","core/notification","core/custom_interaction_events","core/templates"],function(o,t,i,r,c,a,n,p){var l,m,s=function(o){p.render("core/loading",{}).then(function(e){return m.append(e),t.call([{methodname:"core_completion_override_activity_completion_status",args:o}])[0]}).then(function(e){var n=0<e.state?1:0;i.get_string(n?"completion-y-override":"completion-n-override","completion",l).then(function(e){e={state:e,date:"",user:m.attr("data-userfullname"),activity:m.attr("data-activityname")};return i.get_string("progress-title","completion",e)}).then(function(e){var t=m.attr("data-completiontracking");return p.renderPix((t=t,0<n?"i/completion-"+t+"-y-override":"i/completion-"+t+"-n-override"),"core",e)}).then(function(e){var t=0<n?0:1;m.find(".loading-icon").remove(),m.data("changecompl",o.userid+"-"+o.cmid+"-"+t),m.attr("data-changecompl",o.userid+"-"+o.cmid+"-"+t),m.children("img").replaceWith(e)}).catch(a.exception)}).catch(a.exception)};return{init:function(e){l=e,o("#completion-progress a.changecompl").each(function(e,t){n.define(t,[n.events.activate])}),o("#completion-progress").on(n.events.activate,"a.changecompl",function(e,t){var n;e=e,(t=t).originalEvent.preventDefault(),t.originalEvent.stopPropagation(),e.preventDefault(),e.stopPropagation(),t=(m=o(e.currentTarget)).data("changecompl").split("-"),n={userid:t[0],cmid:t[1],newstate:t[2]},i.get_strings([{key:1==n.newstate?"completion-y":"completion-n",component:"completion"}]).then(function(e){return i.get_strings([{key:"confirm",component:"moodle"},{key:"areyousureoverridecompletion",component:"completion",param:e[0]}])}).then(function(e){return r.create({type:r.types.CONFIRM,title:e[0],body:e[1]})}).then(function(e){e.getRoot().on(c.yes,function(){s(n)}),e.getRoot().on(c.hidden,function(){m.focus(),e.destroy()}),e.show()}).catch(a.exception)})}}});