define(["jquery","core/ajax","core/notification","core/custom_interaction_events","core_message/notification_preference","core_message/notification_processor_settings"],function(i,o,a,e,s,n){function t(t){this.root=i(t),this.userId=this.root.attr("data-user-id"),this.registerEventListeners()}var r='[data-region="disable-notification-container"] [data-disable-notifications]',c='[data-region="disable-notification-container"]',f="[data-state]",u='[data-region="preference-row"]',d="[data-state] input",l="[data-processor-setting]";return t.prototype.isDisabled=function(){return this.root.hasClass("disabled")},t.prototype.setDisabled=function(){this.root.addClass("disabled"),this.root.find(d).prop("disabled",!0)},t.prototype.setEnabled=function(){this.root.removeClass("disabled"),this.root.find(d).prop("disabled",!1)},t.prototype.toggleDisableAllStatus=function(){var t=i(r),e=i(c),s=t.prop("checked");if(e.hasClass("loading"))return i.Deferred().resolve();e.addClass("loading");t={methodname:"core_user_update_user_preferences",args:{userid:this.userId,emailstop:s?1:0}};return o.call([t])[0].done(function(){s?this.setDisabled():this.setEnabled()}.bind(this)).always(function(){e.removeClass("loading")}).fail(a.exception)},t.prototype.registerEventListeners=function(){var t=i(r);e.define(this.root,[e.events.activate]),this.root.on("change",function(t){var e;this.isDisabled()||(e=i(t.target).closest(f),t=i(t.target).closest(u),t=new s(t,this.userId),e.addClass("loading"),t.save().always(function(){e.removeClass("loading")}))}.bind(this)),this.root.on(e.events.activate,l,function(t,e){t=i(t.target).closest(l);new n(t).show(),e.originalEvent.preventDefault()}),e.define(t,[e.events.activate]),t.on(e.events.activate,function(){this.toggleDisableAllStatus()}.bind(this))},t});