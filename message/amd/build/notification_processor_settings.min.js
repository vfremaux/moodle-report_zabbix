define(["jquery","core/ajax","core/notification","core/fragment","core/templates","core/str","tool_lp/dialogue"],function(n,s,r,e,a,t,i){function o(e){this.root=n(e),this.name=this.root.attr("data-name"),this.userId=this.root.attr("data-user-id"),this.contextId=this.root.attr("data-context-id")}var c="[data-processor-name]",d='[data-region="preference-row"]';return o.prototype.show=function(){e.loadFragment("message","processor_settings",this.contextId,{userid:this.userId,type:this.name}).done(function(o,s){t.get_string("processorsettings","message").done(function(e){var t=new i(e,o,function(){a.runTemplateJS(s)},function(){t.close()});n(document).on("mpp:formsubmitted",function(){t.close(),this.updateConfiguredStatus()}.bind(this)),n(document).on("mpp:formcancelled",function(){t.close()})}.bind(this))}.bind(this))},o.prototype.updateConfiguredStatus=function(){var t=this.root.closest(c);if(!t.hasClass("unconfigured"))return!1;var o=t.attr("data-processor-name"),e={methodname:"core_message_get_message_processor",args:{name:o,userid:this.userId}};return s.call([e])[0].fail(r.exception).done(function(e){e.userconfigured&&(e=n(d+' [data-processor-name="'+o+'"]'),t.removeClass("unconfigured"),e.removeClass("disabled"))})},o});