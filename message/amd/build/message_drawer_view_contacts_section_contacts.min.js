define(["jquery","core/notification","core/pubsub","core/templates","core_message/message_repository","core_message/message_drawer_events","core_message/message_drawer_lazy_load_list"],function(t,o,e,d,_,c,r){function a(n,e){return n.find('[data-contact-user-id="'+e+'"]')}function T(e,n){return _.getContacts(n,i+1,s).then(function(n){return n}).then(function(n){return n.length>i?n.pop():r.setLoadedAll(e,!0),n}).then(function(n){return s+=i,n}).catch(o.exception)}var i=100,s=0,C={BLOCK_ICON_CONTAINER:'[data-region="block-icon-container"]',CONTACT:'[data-region="contact"]',CONTENT_CONTAINER:'[data-region="contacts-content-container"]'},f={CONTACTS_LIST:"core_message/message_drawer_contacts_list"},u=function(e,n){n=n.map(function(n){return t.extend(n,{id:n.userid})});return d.render(f.CONTACTS_LIST,{contacts:n}).then(function(n){return e.append(n),n}).catch(o.exception)},N=function(n,e){a(n,e).remove()},O=function(n,e){n=a(n,e);n.length&&n.find(C.BLOCK_ICON_CONTAINER).removeClass("hidden")},g=function(n,e){n=a(n,e);n.length&&n.find(C.BLOCK_ICON_CONTAINER).addClass("hidden")};return{show:function(n){var t;n.attr("data-contacts-init")||(t=n,e.subscribe(c.CONTACT_ADDED,function(n){var e=r.getContentContainer(t);u(e,[n]),r.hideEmptyMessage(t),r.showContent(t)}),e.subscribe(c.CONTACT_REMOVED,function(n){N(t,n),t.find(C.CONTACT).length||(r.hideContent(t),r.showEmptyMessage(t))}),e.subscribe(c.CONTACT_BLOCKED,function(n){O(t,n)}),e.subscribe(c.CONTACT_UNBLOCKED,function(n){g(t,n)}),n.attr("data-contacts-init",!0)),r.show(n,T,u)}}});