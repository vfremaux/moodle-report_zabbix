define(["jquery"],function(s){function i(t){var e=s.extend({},t);return e.messages=t.messages.map(function(e){return s.extend({},e)}),e.members=Object.keys(t.members).reduce(function(e,n){return e[n]=s.extend({},t.members[n]),e[n].contactrequests=t.members[n].contactrequests.map(function(e){return s.extend({},e)}),e},{}),e}return{buildInitialState:function(e,n,t){return{midnight:e,loggedInUserId:n,id:t,name:null,subname:null,type:null,totalMemberCount:null,imageUrl:null,isFavourite:null,members:{},messages:[],hasTriedToLoadMessages:!1,loadingMessages:!0,sendingMessage:!1,loadingMembers:!0,loadingConfirmAction:!1,pendingBlockUserIds:[],pendingUnblockUserIds:[],pendingRemoveContactIds:[],pendingAddContactIds:[],pendingDeleteMessageIds:[],pendingDeleteConversation:!1,selectedMessageIds:[]}},addMessages:function(e,n){var t,s,r=i(e),n=(t=e.loggedInUserId,s=e.members,n.map(function(e){var n=e.useridfrom==t;return{id:parseInt(e.id,10),isRead:e.isread,fromLoggedInUser:n,userFrom:s[e.useridfrom],text:e.text,timeCreated:parseInt(e.timecreated,10)}})),e=e.messages.concat(n);return e.sort(function(e,n){return e.timeCreated<n.timeCreated?-1:e.timeCreated>n.timeCreated?1:e.id<n.id?-1:e.id>n.id?1:0}),r.messages=e.filter(function(e,n,t){return!n||e.id!==t[n-1].id}),r},removeMessages:function(e,n){var e=i(e),t=n.map(function(e){return e.id});return e.messages=e.messages.filter(function(e){return t.indexOf(e.id)<0}),e},removeMessagesById:function(e,n){e=i(e);return e.messages=e.messages.filter(function(e){return n.indexOf(e.id)<0}),e},addMembers:function(e,n){var t=i(e);return n.map(function(e){return{id:e.id,fullname:e.fullname,profileurl:e.profileurl,profileimageurl:e.profileimageurl,profileimageurlsmall:e.profileimageurlsmall,isonline:e.isonline,showonlinestatus:e.showonlinestatus,isblocked:e.isblocked,iscontact:e.iscontact,isdeleted:e.isdeleted,canmessage:e.canmessage,requirescontact:e.requirescontact,contactrequests:e.contactrequests||[]}}).forEach(function(e){t.members[e.id]=e}),t},removeMembers:function(e,n){var t=i(e);return n.forEach(function(e){delete t.members[e.id]}),t},setLoadingMessages:function(e,n){var t=i(e);return t.loadingMessages=n,e.loadingMessages&&!n&&(t.hasTriedToLoadMessages=!0),t},setSendingMessage:function(e,n){e=i(e);return e.sendingMessage=n,e},setLoadingMembers:function(e,n){e=i(e);return e.loadingMembers=n,e},setId:function(e,n){e=i(e);return e.id=n,e},setName:function(e,n){e=i(e);return e.name=n,e},setSubname:function(e,n){e=i(e);return e.subname=n,e},setType:function(e,n){e=i(e);return e.type=n,e},setIsFavourite:function(e,n){e=i(e);return e.isFavourite=n,e},setTotalMemberCount:function(e,n){e=i(e);return e.totalMemberCount=n,e},setImageUrl:function(e,n){e=i(e);return e.imageUrl=n,e},setLoadingConfirmAction:function(e,n){e=i(e);return e.loadingConfirmAction=n,e},setPendingDeleteConversation:function(e,n){e=i(e);return e.pendingDeleteConversation=n,e},addPendingBlockUsersById:function(e,n){var t=i(e);return n.forEach(function(e){t.pendingBlockUserIds.push(e)}),t},addPendingRemoveContactsById:function(e,n){var t=i(e);return n.forEach(function(e){t.pendingRemoveContactIds.push(e)}),t},addPendingUnblockUsersById:function(e,n){var t=i(e);return n.forEach(function(e){t.pendingUnblockUserIds.push(e)}),t},addPendingAddContactsById:function(e,n){var t=i(e);return n.forEach(function(e){t.pendingAddContactIds.push(e)}),t},addPendingDeleteMessagesById:function(e,n){var t=i(e);return n.forEach(function(e){t.pendingDeleteMessageIds.push(e)}),t},removePendingBlockUsersById:function(e,n){e=i(e);return e.pendingBlockUserIds=e.pendingBlockUserIds.filter(function(e){return n.indexOf(e)<0}),e},removePendingRemoveContactsById:function(e,n){e=i(e);return e.pendingRemoveContactIds=e.pendingRemoveContactIds.filter(function(e){return n.indexOf(e)<0}),e},removePendingUnblockUsersById:function(e,n){e=i(e);return e.pendingUnblockUserIds=e.pendingUnblockUserIds.filter(function(e){return n.indexOf(e)<0}),e},removePendingAddContactsById:function(e,n){e=i(e);return e.pendingAddContactIds=e.pendingAddContactIds.filter(function(e){return n.indexOf(e)<0}),e},removePendingDeleteMessagesById:function(e,n){e=i(e);return e.pendingDeleteMessageIds=e.pendingDeleteMessageIds.filter(function(e){return n.indexOf(e)<0}),e},addSelectedMessagesById:function(e,n){e=i(e);return e.selectedMessageIds=e.selectedMessageIds.concat(n),e},removeSelectedMessagesById:function(e,n){e=i(e);return e.selectedMessageIds=e.selectedMessageIds.filter(function(e){return n.indexOf(e)<0}),e},markMessagesAsRead:function(e,n){var e=i(e),t=n.map(function(e){return e.id});return e.messages=e.messages.map(function(e){return 0<=t.indexOf(e.id)&&(e.isRead=!0),e}),e},addContactRequests:function(e,n){var s=i(e);return n.forEach(function(e){var n=e.userid,t=e.requesteduserid;s.members[n].contactrequests.push(e),s.members[t].contactrequests.push(e)}),s},removeContactRequests:function(e,n){var s=i(e);return n.forEach(function(e){var n=e.userid,t=e.requesteduserid;s.members[n].contactrequests=s.members[n].contactrequests.filter(function(e){return e.userid!=n}),s.members[t].contactrequests=s.members[t].contactrequests.filter(function(e){return e.requesteduserid!=t})}),s}}});