define(["jquery","core/custom_interaction_events","core/pubsub","core_message/message_drawer_view_contact","core_message/message_drawer_view_contacts","core_message/message_drawer_view_conversation","core_message/message_drawer_view_group_info","core_message/message_drawer_view_overview","core_message/message_drawer_view_search","core_message/message_drawer_view_settings","core_message/message_drawer_router","core_message/message_drawer_routes","core_message/message_drawer_events"],function(s,a,r,e,t,n,o,I,u,O,_,i,E){var c={VIEW_CONTACT:'[data-region="view-contact"]',VIEW_CONTACTS:'[data-region="view-contacts"]',VIEW_CONVERSATION:'[data-region="view-conversation"]',VIEW_GROUP_INFO:'[data-region="view-group-info"]',VIEW_OVERVIEW:'[data-region="view-overview"]',VIEW_SEARCH:'[data-region="view-search"]',VIEW_SETTINGS:'[data-region="view-settings"]',ROUTES:"[data-route]",ROUTES_BACK:"[data-route-back]",HEADER_CONTAINER:'[data-region="header-container"]',BODY_CONTAINER:'[data-region="body-container"]',FOOTER_CONTAINER:'[data-region="footer-container"]'},T=function(e,t){e=e.children();return[e.filter(c.HEADER_CONTAINER).find(t),e.filter(c.BODY_CONTAINER).find(t),e.filter(c.FOOTER_CONTAINER).find(t)].filter(function(e){return e.length})},g=[[i.VIEW_CONTACT,c.VIEW_CONTACT,e.show,e.description],[i.VIEW_CONTACTS,c.VIEW_CONTACTS,t.show,t.description],[i.VIEW_CONVERSATION,c.VIEW_CONVERSATION,n.show,n.description],[i.VIEW_GROUP_INFO,c.VIEW_GROUP_INFO,o.show,o.description],[i.VIEW_OVERVIEW,c.VIEW_OVERVIEW,I.show,I.description],[i.VIEW_SEARCH,c.VIEW_SEARCH,u.show,u.description],[i.VIEW_SETTINGS,c.VIEW_SETTINGS,O.show,O.description]],d=function(e){e.attr("data-shown")||(_.go(i.VIEW_OVERVIEW),e.attr("data-shown",!0)),e.removeClass("hidden"),e.attr("aria-expanded",!0),e.attr("aria-hidden",!1)},N=function(e){e.addClass("hidden"),e.attr("aria-expanded",!1),e.attr("aria-hidden",!0)},V=function(e){return!e.hasClass("hidden")};return{init:function(e){var t,n,o;e=s(e),t=e,g.forEach(function(e){_.add(e[0],T(t,e[1]),e[2],e[3])}),n=e,a.define(n,[a.events.activate]),o=/^data-route-param-?(\d*)$/,n.on(a.events.activate,c.ROUTES,function(e,t){for(var n=s(e.target).closest(c.ROUTES),e=n.attr("data-route"),a=[],r=0;r<n[0].attributes.length;r++)a.push(n[0].attributes[r]);var i=a.filter(function(e){e=e.nodeName;return o.test(e)}),i=(i.sort(function(e,t){e=o.exec(e.nodeName),t=o.exec(t.nodeName),e=1<e.length?e[1]:0,t=1<t.length?t[1]:0;return e<t?-1:t<e?1:0}),i.map(function(e){return e.nodeValue})),e=[e].concat(i);_.go.apply(null,e),t.originalEvent.preventDefault()}),n.on(a.events.activate,c.ROUTES_BACK,function(e,t){_.back(),t.originalEvent.preventDefault()}),r.subscribe(E.SHOW,function(){d(n)}),r.subscribe(E.HIDE,function(){N(n)}),r.subscribe(E.TOGGLE_VISIBILITY,function(){(V(n)?N:d)(n)}),r.subscribe(E.SHOW_CONVERSATION,function(e){d(n),_.go(i.VIEW_CONVERSATION,e)}),r.subscribe(E.CREATE_CONVERSATION_WITH_USER,function(e){d(n),_.go(i.VIEW_CONVERSATION,null,"create",e)}),r.subscribe(E.SHOW_SETTINGS,function(){d(n),_.go(i.VIEW_SETTINGS)}),r.subscribe(E.PREFERENCES_UPDATED,function(e){e=e.filter(function(e){return"message_entertosend"==e.type}),e=e.length?e[0]:null;e&&n.find(c.FOOTER_CONTAINER).find(c.VIEW_CONVERSATION).attr("data-enter-to-send",e.value)})}}});