define(["jquery","core/key_codes","core/pubsub","core/str","core_message/message_drawer_router","core_message/message_drawer_routes","core_message/message_drawer_events","core_message/message_drawer_view_overview_section","core_message/message_repository"],function(e,s,u,r,c,E,_,d,C){function T(e,r){return r===f.FAVOURITE?e.favourites:e.types[r]}var v={CONTACT_REQUEST_COUNT:'[data-region="contact-request-count"]',FAVOURITES:'[data-region="view-overview-favourites"]',GROUP_MESSAGES:'[data-region="view-overview-group-messages"]',MESSAGES:'[data-region="view-overview-messages"]',SEARCH_INPUT:'[data-region="view-overview-search-input"]',SECTION_TOGGLE_BUTTON:"[data-toggle]"},f={PRIVATE:1,PUBLIC:2,FAVOURITE:null},g=null,S=function(e){return e.find(v.SEARCH_INPUT)},A=function(t){return function(){var e=t.find(v.CONTACT_REQUEST_COUNT),r=parseInt(e.text(),10);(r=isNaN(r)?0:r-1)<=0?e.addClass("hidden"):e.text(r)}};return{show:function(e,r){e.attr("data-init")||(a=S(n=e),t=[s.tab,s.shift,s.ctrl,s.alt],a.on("click",function(){c.go(E.VIEW_SEARCH)}),a.on("keydown",function(e){t.indexOf(e.keyCode)<0&&"Meta"!=e.key&&c.go(E.VIEW_SEARCH)}),u.subscribe(_.CONTACT_REQUEST_ACCEPTED,A(n)),u.subscribe(_.CONTACT_REQUEST_DECLINED,A(n)),e.attr("data-init",!0)),S(e).val("");var t,n,a=r.attr("data-user-id"),i=(n=a,g=null===g?C.getAllConversationCounts(n):g),o=[[r.find(v.FAVOURITES),f.FAVOURITE,!0],[r.find(v.GROUP_MESSAGES),f.PUBLIC,!1],[r.find(v.MESSAGES),f.PRIVATE,!1]];return o.forEach(function(e){var r=e[0],t=e[1],e=e[2],n=i.then(function(e){return T(e.total,t)}),a=i.then(function(e){return T(e.unread,t)});d.show(r,t,e,n,a)}),i.then(function(t){var e=o.map(function(e){var r=e[0],e=e[1];return[r,T(t.total,e),T(t.unread,e)]});(e=e).some(function(e){e=e[0];return d.isVisible(e)})||(e.sort(function(e,r){var t=e[1],e=e[2],n=r[1],r=r[2];return 0<e&&0==r?-1:0==e&&0<r?1:0<t&&0==n?-1:0==t&&0<n?1:0}),e[0][0].find(v.SECTION_TOGGLE_BUTTON).click())})},description:function(){return r.get_string("messagedrawerviewoverview","core_message")}}});