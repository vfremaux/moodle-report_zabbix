define(["jquery","core/ajax","core/notification","core_message/message_notification_preference","core/custom_interaction_events"],function(r,a,n,s,e){function t(e){this.root=r(e),this.userId=this.root.find(o).attr("data-user-id"),this.registerEventListeners()}var i="[data-state]",o='[data-region="preferences-container"]',c='[data-region="privacy-setting-container"]';return t.prototype.preferencesDisabled=function(){return this.root.find(o).hasClass("disabled")},t.prototype.saveContactablePrivacySetting=function(){var e=this.root.find(c),t=r("input[type='radio']:checked").val();if(e.hasClass("loading"))return r.Deferred().resolve();e.addClass("loading");t={methodname:"core_user_update_user_preferences",args:{userid:this.userId,preferences:[{type:e.attr("data-preference-key"),value:t}]}};return a.call([t])[0].fail(n.exception).always(function(){e.removeClass("loading")})},t.prototype.registerEventListeners=function(){e.define(this.root,[e.events.activate]),this.root.on("change",function(e){var t,a;"message_blocknoncontacts"==e.target.name?this.saveContactablePrivacySetting():this.preferencesDisabled()||(t=r(e.target).closest(o),a=r(e.target).closest(i),e=new s(t,this.userId),a.addClass("loading"),e.save().always(function(){a.removeClass("loading")}))}.bind(this))},t});