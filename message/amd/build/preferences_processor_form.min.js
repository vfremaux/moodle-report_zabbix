define(["jquery","core/ajax","core/notification","core/custom_interaction_events"],function(o,e,i,n){function t(t){this.root=o(t),this.userId=this.root.attr("data-user-id"),this.name=this.root.attr("data-processor-name"),this.root.find("form").on("submit",function(t){t.preventDefault(),this.save().done(function(){o(document).trigger("mpp:formsubmitted")})}.bind(this)),t=this.root.find("[data-cancel-button]"),n.define(t,[n.events.activate]),t.on(n.events.activate,function(){o(document).trigger("mpp:formcancelled")})}return t.prototype.startLoading=function(){this.root.addClass("loading")},t.prototype.stopLoading=function(){this.root.removeClass("loading")},t.prototype.isLoading=function(){return this.root.hasClass("loading")},t.prototype.save=function(){if(this.isLoading())return o.Deferred();this.startLoading();var t=this.root.find("form").serializeArray(),t={methodname:"core_message_message_processor_config_form",args:{userid:this.userId,name:this.name,formvalues:t}};return e.call([t])[0].fail(i.exception).always(function(){this.stopLoading()}.bind(this))},t});