define(["jquery","core/ajax","core/templates","core/notification","core/custom_interaction_events"],function(n,a,c,o,e){var i=function(e){e.attr("data-is-contact","1")},d=function(e){e.attr("data-is-contact","0")},s=function(e){return e.attr("data-userid")},u=function(e){return e.hasClass("loading")||e.attr("disabled")},l=function(e,t){return u(e)?n.Deferred():(e.addClass("loading"),e.attr("disabled","disabled"),a.call([t])[0].fail(o.exception).always(function(){e.removeClass("loading"),e.removeAttr("disabled")}))};return{enhance:function(r){(r=n(r)).children(".loading-icon").length||c.render("core/loading",{}).done(function(e,t){r.append(e,t)}),e.define(r,[e.events.activate]),r.on(e.events.activate,function(e,t){var n,a,o;"1"==r.attr("data-is-contact")?u(a=r)||(o={methodname:"core_message_delete_contacts",args:{userids:[s(a)]}},l(a,o).done(function(){d(a),c.render("message/add_contact_button",{}).done(function(e,t){c.replaceNodeContents(a,e,t)})})):u(n=r)||(o={methodname:"core_message_create_contacts",args:{userids:[s(n)]}},l(n,o).done(function(){i(n),c.render("message/remove_contact_button",{}).done(function(e,t){c.replaceNodeContents(n,e,t)})})),e.preventDefault(),t.originalEvent.preventDefault()})}}});