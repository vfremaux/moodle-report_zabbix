define(["jquery","core/notification","core/pubsub","core/templates","core_message/message_repository","core_message/message_drawer_events","core_message/message_drawer_lazy_load_list"],function(e,n,r,s,a,o,i){function c(t,e){return e=e.map(function(e){return{id:e.id,profileimageurl:e.profileimageurl,fullname:e.fullname}}),s.render(f.REQUESTS_LIST,{requests:e}).then(function(e){return t.append(e),e}).catch(n.exception)}function u(t,e){return a.getContactRequests(e).then(function(e){return i.setLoadedAll(t,!0),e}).catch(n.exception)}var _='[data-region="contact-request"]',f={REQUESTS_LIST:"core_message/message_drawer_view_contacts_body_section_requests_list"},d=function(t){return function(e){t.find('[data-request-id="'+e.userid+'"]').remove(),t.find(_).length||(i.showEmptyMessage(t),i.hideContent(t))}};return{show:function(e){var t;e.attr("data-contacts-init")||(t=e,r.subscribe(o.CONTACT_REQUEST_ACCEPTED,d(t)),r.subscribe(o.CONTACT_REQUEST_DECLINED,d(t)),e.attr("data-contacts-init",!0)),i.show(e,u,c)}}});