define(["jquery","core/notification","core/str","core/ajax","core/templates","tool_lp/dialogue"],function(r,i,c,a,p,l){function e(e,t,o){this._regionSelector=e,this._userCompetencySelector=t,this._planId=o,r(this._regionSelector).on("click",this._userCompetencySelector,this._handleClick.bind(this))}return e.prototype._handleClick=function(e){e.preventDefault();var e=r(e.target).closest("tr"),o=r(e).data("competencyid"),n=r(e).data("userid"),c=this._planId;a.call([{methodname:"tool_lp_data_for_user_competency_summary_in_plan",args:{competencyid:o,planid:c},done:this._contextLoaded.bind(this),fail:i.exception}])[0].then(function(e){var t="core_competency_user_competency_viewed_in_plan";return e.plan.iscompleted&&(t="core_competency_user_competency_plan_viewed"),a.call([{methodname:t,args:{competencyid:o,userid:n,planid:c}}])[0]}).catch(i.exception)},e.prototype._contextLoaded=function(e){var n=this;p.render("tool_lp/user_competency_summary_in_plan",e).done(function(t,o){c.get_string("usercompetencysummary","report_competency").done(function(e){new l(e,t,p.runTemplateJS.bind(p,o),n._refresh.bind(n),!0)}).fail(i.exception)}).fail(i.exception)},e.prototype._refresh=function(){var e=this._planId;a.call([{methodname:"tool_lp_data_for_plan_page",args:{planid:e},done:this._pageContextLoaded.bind(this),fail:i.exception}])},e.prototype._pageContextLoaded=function(e){var o=this;p.render("tool_lp/plan_page",e).done(function(e,t){p.replaceNode(o._regionSelector,e,t)}).fail(i.exception)},e.prototype._regionSelector=null,e.prototype._userCompetencySelector=null,e.prototype._planId=null,e});