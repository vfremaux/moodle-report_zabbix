define(["jquery"],function(a){function s(){a(".tool-lp-menu .tool-lp-sub-menu").attr("aria-hidden","true"),n=!1}function i(t,e){this.menuRoot=t,this.handlers=e,this.rootMenus=this.menuRoot.children("li"),this.subMenus=this.rootMenus.children("ul"),this.subMenuItems=this.subMenus.children("li"),this.allItems=this.rootMenus.add(this.subMenuItems),this.activeItem=null,this.isChildOpen=!1,this.keys={tab:9,enter:13,esc:27,space:32,left:37,up:38,right:39,down:40},this.addAriaAttributes(),this.addEventListeners()}var t=!1,n=!1;return i.prototype.openSubMenu=function(t){this.setOpenDirection(),s(),t.attr("aria-hidden","false"),n=!0},i.prototype.addEventListeners=function(){var e=this;!1===t&&(a(document).click(function(){n&&s()}),t=!0),this.subMenuItems.mouseenter(function(){return a(this).addClass("menu-hover"),!0}),this.subMenuItems.mouseout(function(){return a(this).removeClass("menu-hover"),!0}),this.allItems.click(function(t){return e.handleClick(a(this),t)}),this.allItems.keydown(function(t){return e.handleKeyDown(a(this),t)}),this.allItems.focus(function(){return e.handleFocus(a(this))}),this.allItems.blur(function(){return e.handleBlur(a(this))})},i.prototype.handleClick=function(s,t){var i,n,r;return t.stopPropagation(),s.parent().is(".tool-lp-menu")?"true"==s.children("ul").first().attr("aria-hidden")?this.openSubMenu(s.children("ul").first()):s.children("ul").first().attr("aria-hidden","true"):(this.allItems.removeClass("menu-hover menu-focus"),this.activeItem=null,this.menuRoot.find("ul").not(".root-level").attr("aria-hidden","true"),i=s.find("a").first(),(n=new a.Event("click")).target=i,r=!1,this.handlers&&a.each(this.handlers,function(t,e){r||0<s.find(t).length&&(t=a.proxy(e,i),r=!1===t(n)||n.isDefaultPrevented())}),r||"#"===i.attr("href")||(window.location.href=i.attr("href"))),!1},i.prototype.handleFocus=function(t){if(null===this.activeItem)this.activeItem=t;else if(t[0]!=this.activeItem[0])return!0;var e=this.activeItem.parentsUntil("ul.tool-lp-menu").filter("li");return this.allItems.removeClass("menu-focus"),this.activeItem.addClass("menu-focus"),e.addClass("menu-focus"),!0===this.isChildOpen&&t.parent().is(".tool-lp-menu")&&"true"==t.attr("aria-haspopup")&&this.openSubMenu(t.children("ul").first()),!0},i.prototype.handleBlur=function(t){return t.removeClass("menu-focus"),!0},i.prototype.setOpenDirection=function(){var t=this.menuRoot.offset(),e=a(document.body).hasClass("dir-rtl"),s=this.rootMenus.outerHeight(),i=this.rootMenus.outerWidth(),n=this.rootMenus.find("ul.tool-lp-sub-menu"),r=(n.css("margin-right",""),n.css("margin-left",""),n.css("margin-top",""),n.attr("aria-hidden",!1),n.outerWidth()),o=n.outerHeight();t.top-a(window).scrollTop()+o>a(window).height()&&n.css("margin-top","-"+(o+s)+"px"),e?t.left-r<0&&n.css("margin-right","-"+(r-i)+"px"):t.left+r>a(window).width()&&n.css("margin-left","-"+(r-i)+"px"),this.menuRoot.addClass("tool-lp-menu-open-left")},i.prototype.handleKeyDown=function(t,e){if(e.altKey||e.ctrlKey)return!0;switch(e.keyCode){case this.keys.tab:this.menuRoot.find("ul").attr("aria-hidden","true"),this.allItems.removeClass("menu-focus"),this.activeItem=null,this.isChildOpen=!1;break;case this.keys.esc:var s=t.parent();return s.is(".tool-lp-menu")?t.children("ul").first().attr("aria-hidden","true"):(this.activeItem=s.parent(),this.isChildOpen=!1,this.activeItem.focus(),s.attr("aria-hidden","true")),e.stopPropagation(),!1;case this.keys.enter:case this.keys.space:return this.handleClick(t,e);case this.keys.left:return this.activeItem=this.moveToPrevious(t),this.activeItem.focus(),e.stopPropagation(),!1;case this.keys.right:return this.activeItem=this.moveToNext(t),this.activeItem.focus(),e.stopPropagation(),!1;case this.keys.up:return this.activeItem=this.moveUp(t),this.activeItem.focus(),e.stopPropagation(),!1;case this.keys.down:return this.activeItem=this.moveDown(t),this.activeItem.focus(),e.stopPropagation(),!1}return!0},i.prototype.moveToNext=function(t){var e=t.parent(),s=e.children("li"),i=s.length,n=s.index(t),r=null,o=null;return e.is(".tool-lp-menu")?(r=n<i-1?t.next():s.first(),"true"==t.attr("aria-haspopup")&&"false"==(o=t.children("ul").first()).attr("aria-hidden")&&(o.attr("aria-hidden","true"),this.isChildOpen=!0),t.removeClass("menu-focus"),"true"===r.attr("aria-haspopup")&&!0===this.isChildOpen&&(o=r.children("ul").first(),this.openSubMenu(o))):"true"==t.attr("aria-haspopup")?(r=(o=t.children("ul").first()).children("li").first(),this.openSubMenu(o)):(i=e=null,(e=t.parentsUntil("ul.tool-lp-menu").filter("ul").not(".tool-lp-menu")).attr("aria-hidden","true"),e.find("li").removeClass("menu-focus"),e.last().parent().removeClass("menu-focus"),i=e.last().parent(),(r=(n=this.rootMenus.index(i))<this.rootMenus.length-1?i.next():this.rootMenus.first()).addClass("menu-focus"),"true"==r.attr("aria-haspopup")&&(r=(o=r.children("ul").first()).children("li").first(),this.openSubMenu(o),this.isChildOpen=!0)),r},i.prototype.moveToPrevious=function(t){var e=t.parent(),s=e.children("li"),i=s.index(t),n=null,r=null;return e.is(".tool-lp-menu")?(n=0<i?t.prev():s.last(),"true"==t.attr("aria-haspopup")&&"false"==(r=t.children("ul").first()).attr("aria-hidden")&&(r.attr("aria-hidden","true"),this.isChildOpen=!0),t.removeClass("menu-focus"),"true"===n.attr("aria-haspopup")&&!0===this.isChildOpen&&(r=n.children("ul").first(),this.openSubMenu(r))):(s=e.parent()).parent().is(".tool-lp-menu")?(e.attr("aria-hidden","true"),t.removeClass("menu-focus"),s.removeClass("menu-focus"),(n=0<(i=this.rootMenus.index(s))?s.prev():this.rootMenus.last()).addClass("menu-focus"),"true"==n.attr("aria-haspopup")&&(r=n.children("ul").first(),this.openSubMenu(r),this.isChildOpen=!0,n=r.children("li").first())):(n=e.parent(),e.attr("aria-hidden","true"),t.removeClass("menu-focus")),n},i.prototype.moveDown=function(t,e){var s=t.parent(),i=s.children("li").not(".separator"),n=i.length,r=i.index(t),o=null,a=null;if(s.is(".tool-lp-menu"))return"true"!=t.attr("aria-haspopup")?t:(o=(a=t.children("ul").first()).children("li").first(),this.openSubMenu(a),o);if(e){var u=!1,l=r+1;for(l==n&&(l=0);l!=r;){if(i.eq(l).html().charAt(0).toLowerCase()==e){u=!0;break}(l+=1)==n&&(l=0)}return!0===u?(o=i.eq(l),t.removeClass("menu-focus"),o):t}return o=r<n-1?i.eq(r+1):i.first(),t.removeClass("menu-focus"),o},i.prototype.moveUp=function(t){var e=t.parent(),s=e.children("li").not(".separator"),i=s.index(t),n=null;return e.is(".tool-lp-menu")?t:(n=0<i?s.eq(i-1):s.last(),t.removeClass("menu-focus"),n)},i.prototype.addAriaAttributes=function(){this.menuRoot.attr("role","menubar"),this.rootMenus.attr("role","menuitem"),this.rootMenus.attr("tabindex","0"),this.rootMenus.attr("aria-haspopup","true"),this.subMenus.attr("role","menu"),this.subMenus.attr("aria-hidden","true"),this.subMenuItems.attr("role","menuitem"),this.subMenuItems.attr("tabindex","-1"),this.menuRoot.addClass("tool-lp-menu"),this.allItems.addClass("tool-lp-menu-item"),this.rootMenus.addClass("tool-lp-root-menu"),this.subMenus.addClass("tool-lp-sub-menu"),this.subMenuItems.addClass("dropdown-item")},{enhance:function(t,s){a(t).each(function(t,e){e=a(e);!0!==e.data("menubarEnhanced")&&(new i(e,s),e.data("menubarEnhanced",!0))})},closeAll:s}});