define(["jquery","core/templates","core/ajax","core/notification","core/str","tool_lp/menubar","tool_lp/event_base"],function(t,e,i,r,n,c,o){function s(){o.prototype.constructor.apply(this,[])}return(s.prototype=Object.create(o.prototype))._nodeSelector='[data-node="user-competency"]',s.prototype._cancelReviewRequest=function(e){var t={methodname:"core_competency_user_competency_cancel_review_request",args:{userid:e.userid,competencyid:e.competencyid}};i.call([t])[0].then(function(){this._trigger("review-request-cancelled",e),this._trigger("status-changed",e)}.bind(this)).catch(function(){this._trigger("error-occured",e)}.bind(this))},s.prototype.cancelReviewRequest=function(e){this._cancelReviewRequest(e)},s.prototype._cancelReviewRequestHandler=function(e){e.preventDefault();e=this._findUserCompetencyData(t(e.target));this.cancelReviewRequest(e)},s.prototype._requestReview=function(e){var t={methodname:"core_competency_user_competency_request_review",args:{userid:e.userid,competencyid:e.competencyid}};i.call([t])[0].then(function(){this._trigger("review-requested",e),this._trigger("status-changed",e)}.bind(this)).catch(function(){this._trigger("error-occured",e)}.bind(this))},s.prototype.requestReview=function(e){this._requestReview(e)},s.prototype._requestReviewHandler=function(e){e.preventDefault();e=this._findUserCompetencyData(t(e.target));this.requestReview(e)},s.prototype._startReview=function(e){var t={methodname:"core_competency_user_competency_start_review",args:{userid:e.userid,competencyid:e.competencyid}};i.call([t])[0].then(function(){this._trigger("review-started",e),this._trigger("status-changed",e)}.bind(this)).catch(function(){this._trigger("error-occured",e)}.bind(this))},s.prototype.startReview=function(e){this._startReview(e)},s.prototype._startReviewHandler=function(e){e.preventDefault();e=this._findUserCompetencyData(t(e.target));this.startReview(e)},s.prototype._stopReview=function(e){var t={methodname:"core_competency_user_competency_stop_review",args:{userid:e.userid,competencyid:e.competencyid}};i.call([t])[0].then(function(){this._trigger("review-stopped",e),this._trigger("status-changed",e)}.bind(this)).catch(function(){this._trigger("error-occured",e)}.bind(this))},s.prototype.stopReview=function(e){this._stopReview(e)},s.prototype._stopReviewHandler=function(e){e.preventDefault();e=this._findUserCompetencyData(t(e.target));this.stopReview(e)},s.prototype.enhanceMenubar=function(e){c.enhance(e,{'[data-action="request-review"]':this._requestReviewHandler.bind(this),'[data-action="cancel-review-request"]':this._cancelReviewRequestHandler.bind(this)})},s.prototype._findUserCompetencyData=function(e){var e=e.parents(this._nodeSelector);if(1!=e.length)throw new Error("The evidence node was not located.");if(void 0===(e=e.data())||void 0===e.userid||void 0===e.competencyid)throw new Error("User competency data could not be found.");return e},s.prototype.enhanceMenubar=function(e){c.enhance(e,{'[data-action="request-review"]':this._requestReviewHandler.bind(this),'[data-action="cancel-review-request"]':this._cancelReviewRequestHandler.bind(this),'[data-action="start-review"]':this._startReviewHandler.bind(this),'[data-action="stop-review"]':this._stopReviewHandler.bind(this)})},s.prototype.registerEvents=function(e){e=t(e);e.find('[data-action="request-review"]').click(this._requestReviewHandler.bind(this)),e.find('[data-action="cancel-review-request"]').click(this._cancelReviewRequestHandler.bind(this)),e.find('[data-action="start-review"]').click(this._startReviewHandler.bind(this)),e.find('[data-action="stop-review"]').click(this._stopReviewHandler.bind(this))},s});