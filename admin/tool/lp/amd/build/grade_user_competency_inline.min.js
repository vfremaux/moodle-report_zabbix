define(["jquery","core/notification","core/ajax","core/log","tool_lp/grade_dialogue","tool_lp/event_base","tool_lp/scalevalues"],function(s,i,r,e,_,a,t){function o(e,t,o,n,c,i,r){if(a.prototype.constructor.apply(this,[]),!(e=s(e)).length)throw new Error("Could not find the trigger");this._scaleId=t,this._competencyId=o,this._userId=n,this._planId=c,this._courseId=i,this._chooseStr=r,this._setUp(),e.click(function(e){e.preventDefault(),this._dialogue.display()}.bind(this)),this._planId?(this._methodName="core_competency_grade_competency_in_plan",this._args={competencyid:this._competencyId,planid:this._planId}):this._courseId?(this._methodName="core_competency_grade_competency_in_course",this._args={competencyid:this._competencyId,courseid:this._courseId,userid:this._userId}):(this._methodName="core_competency_grade_competency",this._args={userid:this._userId,competencyid:this._competencyId})}return(o.prototype=Object.create(a.prototype))._setUp=function(){var n=[],c=this;t.get_values(c._scaleId).done(function(e){n.push({value:"",name:c._chooseStr});for(var t=0;t<e.length;t++){var o=e[t];n.push({value:o.id,name:o.name})}c._dialogue=new _(n),c._dialogue.on("rated",function(e,t){var o=c._args;o.grade=t.rating,o.note=t.note,r.call([{methodname:c._methodName,args:o,done:function(e){c._trigger("competencyupdated",{args:o,evidence:e})},fail:i.exception}])})}).fail(i.exception)},o.prototype._scaleId=null,o.prototype._competencyId=null,o.prototype._userId=null,o.prototype._planId=null,o.prototype._courseId=null,o.prototype._chooseStr=null,o.prototype._dialogue=null,o});