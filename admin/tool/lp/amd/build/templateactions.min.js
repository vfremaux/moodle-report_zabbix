define(["jquery","core/templates","core/ajax","core/notification","core/str","tool_lp/actionselector"],function(n,o,t,a,l,r){function c(){t.call([{methodname:"core_competency_delete_template",args:{id:m,deleteplans:i}},{methodname:"tool_lp_data_for_templates_manage_page",args:{pagecontext:{contextid:p}}}])[1].done(d).fail(a.exception)}var p=0,m=0,i=!0,_=function(e,t){n('[data-region="managetemplates"]').replaceWith(e),o.runTemplateJS(t)},d=function(e){o.render("tool_lp/manage_templates_page",e).done(_).fail(a.exception)};return{deleteHandler:function(e){e.preventDefault();var e=n(this).attr("data-templateid"),o=(m=e,i=!0,t.call([{methodname:"core_competency_read_template",args:{id:m}},{methodname:"core_competency_template_has_related_data",args:{id:m}}]));o[0].done(function(t){o[1].done(function(e){(e?l.get_strings([{key:"deletetemplate",component:"tool_lp",param:t.shortname},{key:"deletetemplatewithplans",component:"tool_lp"},{key:"deleteplans",component:"tool_lp"},{key:"unlinkplanstemplate",component:"tool_lp"},{key:"confirm",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(e){var t=[{text:e[2],value:"delete"},{text:e[3],value:"unlink"}],t=new r(e[0],e[1],t,e[4],e[5]);t.display(),t.on("save",function(e,t){"delete"!=t.action&&(i=!1),c()})}):l.get_strings([{key:"confirm",component:"moodle"},{key:"deletetemplate",component:"tool_lp",param:t.shortname},{key:"delete",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(e){a.confirm(e[0],e[1],e[2],e[3],c)})).fail(a.exception)}).fail(a.exception)}).fail(a.exception)},duplicateHandler:function(e){e.preventDefault(),m=n(this).attr("data-templateid"),t.call([{methodname:"core_competency_duplicate_template",args:{id:m}},{methodname:"tool_lp_data_for_templates_manage_page",args:{pagecontext:{contextid:p}}}])[1].done(d).fail(a.exception)},init:function(e){p=e}}});