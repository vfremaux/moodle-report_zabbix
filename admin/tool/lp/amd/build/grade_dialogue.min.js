define(["jquery","core/notification","core/templates","tool_lp/dialogue","tool_lp/event_base","core/str"],function(i,t,n,e,o,r){function p(t){o.prototype.constructor.apply(this,[]),this._ratingOptions=t}return(p.prototype=Object.create(o.prototype))._popup=null,p.prototype._ratingOptions=null,p.prototype._afterRender=function(){var t=this._find('[data-action="rate"]'),n=this._find('[name="rating"]'),e=this._find('[name="comment"]');this._find('[data-action="cancel"]').click(function(t){t.preventDefault(),this._trigger("cancelled"),this.close()}.bind(this)),n.change(function(){i(this).val()?t.prop("disabled",!1):t.prop("disabled",!0)}).change(),t.click(function(t){t.preventDefault();t=n.val();t&&(this._trigger("rated",{rating:t,note:e.val()}),this.close())}.bind(this))},p.prototype.close=function(){this._popup.close(),this._popup=null},p.prototype.display=function(){return this._render().then(function(n){return r.get_string("rate","tool_lp").then(function(t){this._popup=new e(t,n,this._afterRender.bind(this))}.bind(this))}.bind(this)).fail(t.exception)},p.prototype._find=function(t){return i(this._popup.getContent()).find(t)},p.prototype._render=function(){var t={cangrade:this._canGrade,ratings:this._ratingOptions};return n.render("tool_lp/competency_grader",t)},p});