define(["jquery","core/ajax","core/templates"],function(i,a,o){return{processResults:function(e,n){var t=[];return i.each(n,function(e,n){t.push({value:n.id,label:n._label})}),t},transport:function(e,n,r,t){e=i(e).data("capability");a.call([{methodname:"tool_lp_search_users",args:{query:n,capability:e=void 0===e?"":e}}])[0].then(function(e){var n=[],a=0;return i.each(e.users,function(e,t){var a=t,r=[];i.each(["idnumber","email","phone1","phone2","department","institution"],function(e,n){void 0!==t[n]&&""!==t[n]&&(a.hasidentity=!0,r.push(t[n]))}),a.identity=r.join(", "),n.push(o.render("tool_lp/form-user-selector-suggestion",a))}),i.when.apply(i.when,n).then(function(){var t=arguments;i.each(e.users,function(e,n){n._label=t[a],a++}),r(e.users)})}).catch(t)}}});