define(["jquery","core/notification","tool_lp/dialogue","core/str","core/ajax","core/templates"],function(n,i,o,s,c,a){function e(e){n(e).on("click",this.configureSettings.bind(this))}return e.prototype._dialogue=null,e.prototype.configureSettings=function(e){var t={courseid:n(e.target).closest("a").data("courseid"),settings:{pushratingstouserplans:n(e.target).closest("a").data("pushratingstouserplans")}};e.preventDefault(),a.render("tool_lp/course_competency_settings",t).done(function(t){s.get_string("configurecoursecompetencysettings","tool_lp").done(function(e){this._dialogue=new o(e,t,this.addListeners.bind(this))}.bind(this)).fail(i.exception)}.bind(this)).fail(i.exception)},e.prototype.addListeners=function(){this._find('[data-action="save"]').on("click",this.saveSettings.bind(this)),this._find('[data-action="cancel"]').on("click",this.cancelChanges.bind(this))},e.prototype.cancelChanges=function(e){e.preventDefault(),this._dialogue.close()},e.prototype._find=function(e){return n('[data-region="coursecompetencysettings"]').find(e)},e.prototype.saveSettings=function(e){e.preventDefault();var e=this._find('input[name="pushratingstouserplans"]:checked').val(),t=this._find('input[name="courseid"]').val();c.call([{methodname:"core_competency_update_course_competency_settings",args:{courseid:t,settings:{pushratingstouserplans:e}}}])[0].done(function(){this.refreshCourseCompetenciesPage()}.bind(this)).fail(i.exception)},e.prototype.refreshCourseCompetenciesPage=function(){var e=this._find('input[name="courseid"]').val();c.call([{methodname:"tool_lp_data_for_course_competencies_page",args:{courseid:e}}])[0].done(function(e){a.render("tool_lp/course_competencies_page",e).done(function(e,t){n('[data-region="coursecompetenciespage"]').replaceWith(e),a.runTemplateJS(t),this._dialogue.close()}.bind(this)).fail(i.exception)}.bind(this)).fail(i.exception)},e});