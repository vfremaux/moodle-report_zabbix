define(["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","core/templates"],function(a,r,i,c,s,d,l){function t(){this.registerEvents()}var e='[data-action="cancel"]',o='[data-action="contactdpo"]';return t.prototype.registerEvents=function(){a(e).click(function(t){t.preventDefault();var o=a(this).data("requestid");c.get_strings([{key:"cancelrequest",component:"tool_dataprivacy"},{key:"cancelrequestconfirmation",component:"tool_dataprivacy"}]).then(function(t){var e=t[0],t=t[1];return s.create({title:e,body:t,type:s.types.SAVE_CANCEL}).then(function(t){return t.setSaveButtonText(e),t.getRoot().on(d.save,function(){r.call([{methodname:"tool_dataprivacy_cancel_data_request",args:{requestid:o}}])[0].done(function(t){t.result?window.location.reload():i.addNotification({message:t.warnings[0].message,type:"error"})}).fail(i.exception)}),t.getRoot().on(d.hidden,function(){t.destroy()}),t})}).done(function(t){t.show()}).fail(i.exception)}),a(o).click(function(t){t.preventDefault();var o=a(this).data("replytoemail"),n="";c.get_strings([{key:"contactdataprotectionofficer",component:"tool_dataprivacy"},{key:"send",component:"tool_dataprivacy"}]).then(function(t){var e=t[0],t=(n=t[1],{replytoemail:o});return s.create({title:e,body:l.render("tool_dataprivacy/contact_dpo",t),type:s.types.SAVE_CANCEL,large:!0})}).done(function(t){t.setSaveButtonText(n),t.getRoot().on(d.save,function(t){var e,o=a("#message").val().trim();0===o.length?(t.preventDefault(),a('[data-region="messageinput"]').addClass("has-danger notifyproblem"),a("#id_error_message").removeAttr("hidden")):(t={methodname:"tool_dataprivacy_contact_dpo",args:{message:t=o}},e="success",r.call([t])[0].then(function(t){return t.result?c.get_string("requestsubmitted","tool_dataprivacy"):(e="error",t.warnings.join("<br>"))}).done(function(t){i.addNotification({message:t,type:e})}).fail(i.exception))}),t.getRoot().on(d.hidden,function(){t.destroy()}),t.show()}).fail(i.exception)})},{init:function(){return new t}}});