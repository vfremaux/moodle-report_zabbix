define(["jquery","core/ajax","core/notification","core/modal_factory","core/modal_events"],function(o,i,c,a,s){function e(){this.registerEvents()}var t='[data-action="view"]';return e.prototype.registerEvents=function(){o(t).click(function(e){e.preventDefault();var e={methodname:"tool_policy_get_policy_version",args:{versionid:o(this).data("versionid"),behalfid:o(this).data("behalfid")}},t=o.Deferred(),n=o.Deferred(),r=a.create({title:t,body:n,large:!0}).then(function(e){return e.getRoot().on(s.hidden,function(){e.destroy()}),e}).then(function(e){return e.show(),e}).catch(c.exception),e=i.call([e]);o.when(e[0]).then(function(e){if(e.result.policy)return t.resolve(e.result.policy.name),n.resolve(e.result.policy.content),e;throw new Error(e.warnings[0].message)}).catch(function(e){return r.then(function(e){return e.hide(),e.destroy(),e}).catch(c.exception),c.addNotification({message:e,type:"error"})})})},{init:function(){return new e}}});