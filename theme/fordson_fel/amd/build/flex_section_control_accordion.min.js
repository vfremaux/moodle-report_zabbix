define(["jquery","core/config","core/log"],function(c,a,l){var o={courseid:0,init:function(e){this.courseid=e,c(".flexcontrol").on("click",this.togglestate),c(".section-caption").on("keydown",this.togglekeyreceiver),c(".flexsection-global-control").on("click",this.processglobal),c(".flexsections > .section > .content > .sectionname").on("click",this.proxysectionnameevent),l.debug("AMD Flex sections control initialized")},init_editing:function(e){this.courseid=e,c(".section.sub > .content > .section-content").css("display","block"),c(".section.sub > .content > .section-content").css("visibility","visible"),c(".section.sub > .content > .summary").css("display","block"),c(".section.sub > .content > .summary").css("visibility","visible"),c(".section.sub >.content > .flexsections").css("display","block"),c(".section.sub >.content > .flexsections").css("visibility","visible"),c(".flexcontrol").on("click",this.togglestate),c(".flexsection-global-control").on("click",this.processglobal),l.debug("AMD Flex sections control initialized v1.3")},proxysectionnameevent:function(e){e.stopPropagation(),e.preventDefault(),c(this).find("img").trigger("click")},togglestate:function(e,t){e.stopPropagation(),e.preventDefault();var s=c(this),e=(s.hasClass("sectioname")?/sectioname-([0-9]+)-section-([0-9]+)/:/control-([0-9]+)-section-([0-9]+)/).exec(s.attr("id")),o=parseInt(e[1]),n=parseInt(e[2]),e=(e=/level-([0-9]+)/.exec(s.attr("class")),parseInt(e[1])),i=(l.debug("Working for flex section "+n+" of id "+o),a.wwwroot+"/theme/fordson_fel/sections/ajax/register.php?");return i+="sectionid="+o,t||(o=s.closest("li").parent().closest("li").attr("id"),c.each(c("#"+o+" .flexcontrol.level-"+e),function(e,t){c(t).attr("id")!=s.attr("id")&&c(t).trigger("click",!0)})),c("#section-"+n).hasClass("expanded")||!0===t?(c("#section-"+n).addClass("collapsed"),c("#section-"+n).removeClass("expanded"),l.debug("Changing section #section-title-"+n+" to false"),c("#section-title-"+n).attr("aria-expanded","false"),c("#section-"+n+" > .content > .section-content").addClass("collpased"),c("#section-"+n+" > .content > .section-content").removeClass("expanded"),t=1):(c("#section-"+n).addClass("expanded"),c("#section-"+n).removeClass("collapsed"),l.debug("Changing section #section-title-"+n+" to true"),c("#section-title-"+n).attr("aria-expanded","true"),c("#section-"+n+" > .content > .section-content").addClass("expanded"),c("#section-"+n+" > .content > .section-content").removeClass("collapsed"),t=0,(o=s.offset()).top-=70,c("html, body").animate({scrollTop:o.top,scrollLeft:0})),c.get(i+="&hide="+t,function(){}),!1},processglobal:function(e){e.stopPropagation(),e.preventDefault();var e=c(this),e=/flexsections-control-([a-z]+)/.exec(e.attr("id"))[1],t=(t=a.wwwroot+"/theme/fordson_fel/sections/ajax/register.php?")+("id="+o.courseid)+("&what="+e);switch(e){case"collapseall":c(".section.sub").removeClass("expanded"),c(".section.sub").addClass("collapsed"),c(".section-content").addClass("collpased"),c(".section-content").removeClass("expanded"),c(".section-title").attr("aria-expanded","false");break;case"expandall":c(".section").removeClass("collapsed"),c(".section").addClass("expanded"),c(".section-content").addClass("expanded"),c(".section-content").removeClass("collapsed"),c(".section-title").attr("aria-expanded","true");break;case"map":c(".section").removeClass("collapsed"),c(".section").addClass("expanded"),c(".section-content").removeClass("expanded"),c(".section-content").addClass("collapsed"),c(".section-title").attr("aria-expanded","false"),c(".section.isleaf").addClass("expanded"),c(".section.isleaf").removeClass("collapsed"),c(".section.isleaf .section-title").attr("aria-expanded","true")}c.get(t)},togglekeyreceiver:function(e){var t,s=c(this);13!=e.keyCode&&32!=e.keyCode||(t=s.closest("li").attr("id").replace("section-",""),s=s.find("#section-title-"+t+" > div.flexcontrol"),c.proxy(o.togglestate,s)(e))}};return o});