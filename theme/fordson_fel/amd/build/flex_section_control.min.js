define(["jquery","core/config","core/log"],function(i,c,a){var o={courseid:0,init:function(e){this.courseid=e,i(".flexcontrol").on("click",this.togglestate),i(".section-caption").on("keydown",this.togglekeyreceiver),i(".flexsection-global-control").on("click",this.processglobal),i(".flexsections > .section > .content > .sectionname").on("click",this.proxysectionnameevent),a.debug("AMD Flex sections control initialized")},init_editing:function(e){this.courseid=e,i(".section.sub > .content > .section-content").css("display","block"),i(".section.sub > .content > .section-content").css("visibility","visible"),i(".section.sub > .content > .summary").css("display","block"),i(".section.sub > .content > .summary").css("visibility","visible"),i(".section.sub >.content > .flexsections").css("display","block"),i(".section.sub >.content > .flexsections").css("visibility","visible"),i(".flexcontrol").on("click",this.togglestate),i(".flexsection-global-control").on("click",this.processglobal),a.debug("AMD Flex sections control initialized v1.3")},proxysectionnameevent:function(e){e.stopPropagation(),e.preventDefault(),i(this).find("img").trigger("click")},togglestate:function(e,t){e.stopPropagation(),e.preventDefault();var e=i(this),s=(e.hasClass("sectioname")?/sectioname-([0-9]+)-section-([0-9]+)/:/control-([0-9]+)-section-([0-9]+)/).exec(e.attr("id")),o=parseInt(s[1]),n=parseInt(s[2]),s=(s=/level-([0-9]+)/.exec(e.attr("class")),parseInt(s[1]),a.debug("Working for flex section "+n+" of id "+o),c.wwwroot+"/theme/fordson_fel/sections/ajax/register.php?");return s+="sectionid="+o,i("#section-"+n).hasClass("expanded")||!0===t?(i("#section-"+n).addClass("collapsed"),i("#section-"+n).removeClass("expanded"),a.debug("Changing section #section-title-"+n+" to false"),i("#section-title-"+n).attr("aria-expanded","false"),i("#section-"+n+" > .content > .section-content").addClass("collpased"),i("#section-"+n+" > .content > .section-content").removeClass("expanded"),t=1):(i("#section-"+n).addClass("expanded"),i("#section-"+n).removeClass("collapsed"),a.debug("Changing section #section-title-"+n+" to true"),i("#section-title-"+n).attr("aria-expanded","true"),i("#section-"+n+" > .content > .section-content").addClass("expanded"),i("#section-"+n+" > .content > .section-content").removeClass("collapsed"),t=0,(o=e.offset()).top-=70,i("html, body").animate({scrollTop:o.top,scrollLeft:0})),i.get(s+="&hide="+t,function(){}),!1},processglobal:function(e){e.stopPropagation(),e.preventDefault();var e=i(this),e=/flexsections-control-([a-z]+)/.exec(e.attr("id"))[1],t=(t=c.wwwroot+"/theme/fordson_fel/sections/ajax/register.php?")+("id="+o.courseid)+("&what="+e);switch(e){case"collapseall":i(".section.sub").removeClass("expanded"),i(".section.sub").addClass("collapsed"),i(".section-content").addClass("collpased"),i(".section-content").removeClass("expanded"),i(".section-title").attr("aria-expanded","false");break;case"expandall":i(".section").removeClass("collapsed"),i(".section").addClass("expanded"),i(".section-content").addClass("expanded"),i(".section-content").removeClass("collapsed"),i(".section-title").attr("aria-expanded","true");break;case"map":i(".section").removeClass("collapsed"),i(".section").addClass("expanded"),i(".section-content").removeClass("expanded"),i(".section-content").addClass("collapsed"),i(".section-title").attr("aria-expanded","false"),i(".section.isleaf").addClass("expanded"),i(".section.isleaf").removeClass("collapsed"),i(".section.isleaf .section-title").attr("aria-expanded","true")}i.get(t)},togglekeyreceiver:function(e){var t,s=i(this);13!=e.keyCode&&32!=e.keyCode||(t=s.closest("li").attr("id").replace("section-",""),s=s.find("#section-title-"+t+" > div.flexcontrol"),i.proxy(o.togglestate,s)(e))}};return o});