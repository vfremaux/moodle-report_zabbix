define(["jquery","core/fragment","core/str","core/modal_events","core/modal_factory","core/notification","core/custom_interaction_events","core_question/repository","core_question/selectors"],function(c,d,t,e,n,s,o,v,f){function i(r){var a=n.create({type:n.types.SAVE_CANCEL,large:!1},[r,f.actions.edittags]).then(function(a){return t.get_string("questiontags","question").then(function(t){return a.setTitle(t),t}).fail(s.exception),a.getRoot().on(e.save,function(t){a.getBody().find("form").submit(),t.preventDefault()}),a.getRoot().on("submit","form",function(t){var n,e,o,i;i=a,g(n=r),l(n),e=m(i),o=h(i),i=y(i),v.submitTagCreateUpdateForm(o,i,e).always(function(){p(n),u(n)}).fail(s.exception).then(function(){a.hide(),location.reload()}).fail(s.exception),t.preventDefault(),t.stopPropagation()}),a});r.on(o.events.activate,f.actions.edittags,function(t){var n=c(t.currentTarget),e=n.data("questionid"),o=!!n.data("cantag"),i=n.data("contextid");a.then(function(t){g(r),l(r);var n=d.loadFragment("question","tags_form",i,{id:e});return t.setBody(n),n.then(function(){u(r)}).always(function(){p(r)}).fail(s.exception),o?t.getRoot().find(f.actions.save).show():t.getRoot().find(f.actions.save).hide(),n=e,t.getBody().attr("data-questionid",n),n=i,t.getBody().attr("data-contextid",n),t}).fail(s.exception),t.preventDefault()})}var u=function(t){t.find(f.actions.save).prop("disabled",!1)},g=function(t){t.find(f.actions.save).prop("disabled",!0)},m=function(t){return t.getBody().find("form").serialize()},l=function(t){t.find(f.containers.loadingIcon).removeClass("hidden")},p=function(t){t.find(f.containers.loadingIcon).addClass("hidden")},y=function(t){return t.getBody().data("contextid")},h=function(t){return t.getBody().data("questionid")};return{init:function(t){t=c(t),i(t)}}});