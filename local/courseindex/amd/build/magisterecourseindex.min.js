define(["jquery","core/log","core/config"],function(t,a,s){var o={init:function(e){t(".courseindex-coursethumb.direct").bind("click",this.goto_course),t(".courseindex-coursename.direct").bind("click",this.goto_course),t(".courseindex-coursethumb.detailed").bind("click",this.load_course_detail),t(".courseindex-coursename.detailed").bind("click",this.load_course_detail),t(".courseindex-readmorelink").bind("click",this.load_course_detail),t(".modal-close").bind("click",this.close_course_detail),t(".courseindex-filter-value").bind("change",this.submitfilters),t(".ftoggle-handle").bind("click",this.toggle),t("#courseindex-modal-shadow").bind("click",this.close_course_detail),t("#search-input").bind("keypress",this.search_form_submit),t("#courseindex-nav").length&&o.opencurrenttree(),e=e.replace(/,/g,"-"),t("#ftoggle-handle"+e).trigger("click"),a.debug("AMD local_courseindex magistere module init.")},submitfilters:function(){t("#courseindex-magistere-filter-form").submit()},search_form_submit:function(e){"13"==(e.keyCode||e.which)&&(e=s.wwwroot+"/local/courseindex/explorer.php",e=(e+="?lpstatus=")+"&searchtext="+t("#search-input").val()+"&title=1&description=1&go_freesearch=Chercher",window.location=e)},load_course_detail:function(){var e=t(this),a='<div class="centered"><center><img id="detail-waiter" src="',a=(a+=s.wwwroot+'/pix/i/ajaxloader.gif" /></center></div>',t("#courseindex-course-detail-content").html(a),t("#courseindex-course-detail-actions").html(a),e.closest(".local-courseindex-fp-coursebox")),o=("page"===a.attr("data-format")?(o=s.wwwroot+"/course/format/page/viewpage.php",o=(o+="?id="+a.attr("data-course"))+"&page="+a.attr("data-page"),t.get(o,function(e){t("#courseindex-course-detail-content").html(e)},"html")):(o=s.wwwroot+"/local/courseindex/pro/ajax/viewcourse.php",o+="?id="+a.attr("data-course"),t.get(o,function(e){t("#courseindex-course-detail-content").html(e)},"html")),s.wwwroot+"/local/courseindex/pro/ajax/courseactions.php");o+="?id="+a.attr("data-course"),t.get(o,function(e){t("#courseindex-course-detail-actions").html(e)},"html"),t("body").addClass("courseindex-detail-open"),t("#courseindex-modal-shadow").css("display","block")},close_course_detail:function(){t("body").removeClass("courseindex-detail-open"),t("#courseindex-modal-shadow").css("display","none")},goto_course:function(){var e=t(this).closest(".local-courseindex-fp-coursebox"),a=s.wwwroot+"/course/view.php";a+="?id="+e.attr("data-course"),window.location=a},toggle:function(){var e,a=t(this).attr("data-toggle"),o=a.replace("toggle-","");"none"===t("#"+a).css("display")?(t("#"+a).css("display","block"),(e=t("#ftoggle-handle-"+o+" img").attr("src"))&&e.replace("collapsed","expanded"),t("#ftoggle-handle-"+o+" img").attr("src",e),t("#ftoggle-handle-"+o+" i").hasClass("fa-caret-down")?(t("#ftoggle-handle-"+o+" i").removeClass("fa-caret-down"),t("#ftoggle-handle-"+o+" i").addClass("fa-caret-up")):(t("#ftoggle-handle-"+o+" i").removeClass("fa-plus-square"),t("#ftoggle-handle-"+o+" i").addClass("fa-minus-square"))):(t("#"+a).css("display","none"),(e=t("#ftoggle-handle-"+o+" img").attr("src"))&&e.replace("expanded","collapsed"),t("#ftoggle-handle-"+o+" img").attr("src",e),t("#ftoggle-handle-"+o+" i").hasClass("fa-caret-up")?(t("#ftoggle-handle-"+o+" i").removeClass("fa-caret-up"),t("#ftoggle-handle-"+o+" i").addClass("fa-caret-down")):(t("#ftoggle-handle-"+o+" i").removeClass("fa-minus-square"),t("#ftoggle-handle-"+o+" i").addClass("fa-plus-square")))},opencurrenttree:function(){var a,o;t(".is-current").parents(".subcats").each(function(){o=t(this),a=o.attr("id"),a=a.replace("toggle-",""),o.css("display","block");var e=t("#ftoggle-handle-"+a+" img").attr("src");e&&e.replace("collapsed","expanded"),t("#ftoggle-handle-"+a+" i").hasClass("fa-caret-down")?(t("#ftoggle-handle-"+a+" i").removeClass("fa-caret-down"),t("#ftoggle-handle-"+a+" i").addClass("fa-caret-up")):(t("#ftoggle-handle-"+a+" i").removeClass("fa-plus-square"),t("#ftoggle-handle-"+a+" i").addClass("fa-minus-square")),t("#ftoggle-handle-"+a+" img").attr("src",e)})}};return o});