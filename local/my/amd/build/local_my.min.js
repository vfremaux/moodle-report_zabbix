define(["jquery","core/config","core/log"],function(c,d,n){var h={usereloadwaiter:!1,init:function(){c("#mydashboard").on("click",".local-my-cat-collapse",[],this.toggle_cat_state),c("#mydashboard").on("change",".local-my-modality-chooser",[],this.toggle_modality),c("#mydashboard").on("click",".local-my-area-ctls",[],this.global_area_ctl),c("#mydashboard").on("click",".detail-handle",[],this.toggle_detail),c("#mydashboard").on("click",".add-to-favorites-handle",[],this.add_to_favorites),c("#mydashboard").on("click",".remove-from-favorites-handle",[],this.remove_from_favorites),c("#mydashboard").on("click",".course-filter",[],this.refresh_course_list),c("#mydashboard").on("click",".course-sort",[],this.refresh_course_list),c("#mydashboard").on("click",".course-display",[],this.refresh_course_list),c("#mydashboard").on("click",".course-time",[],this.refresh_course_list),c("#mydashboard").on("click",".reload-areas",[],this.refresh_course_list),0!==c(".is-accordion").length&&(c(".is-accordion .local-my-course").hide(),c(".is-accordion .local-my-cat-collapse > h3 > a").attr("aria-expanded","false")),c(".reload-areas").each(function(){n.debug("Launching refresh on "+c(this).attr("data-widget")+"-"+c(this).attr("data-uid")),c(this).trigger("click")}),this.usereloadwaiter=!0,n.debug("AMD Local My initialized")},postreset:function(){0!==c(".is-accordion").length&&(c(".is-accordion .local-my-course").hide(),c(".is-accordion .local-my-cat-collapse > h3 > a").attr("aria-expanded","false"))},hide_home_nav:function(){c('a[data-key="home"]').css("display","none")},toggle_cat_state:function(a){a.stopPropagation(),a.preventDefault();var t,e,a=c(this),r=/local-my-cathandle-([^-]+)-([0-9]+)/.exec(a.attr("id"));if(r)return t=r[1],r=parseInt(r[2]),n.debug("Working for cat "+r+" in area "+t),0===a.closest(".is-accordion").length?(a=(a=d.wwwroot+"/local/my/ajax/stateregister.php?")+"item="+t+"&catid="+r,e=0,e=c(".local-my-course-"+t+".cat-"+t+"-"+r).first().hasClass("collapsed")?(c(".local-my-course-"+t+".cat-"+t+"-"+r).removeClass("collapsed"),c("#local-my-cathandle-"+t+"-"+r+" > h3 > a").attr("aria-expanded","true"),n.debug("Expanding "+t+" in area "+r),0):(c(".local-my-course-"+t+".cat-"+t+"-"+r).addClass("collapsed"),c("#local-my-cathandle-"+t+"-"+r+" > h3 > a").attr("aria-expanded","false"),n.debug("Closing "+t+" in area "+r),1),c.get(a+="&hide="+e,function(){})):(c(".local-my-course-"+t).slideUp("normal"),c(".local-my-cat-collapse-"+t+" > h3 > a").attr("aria-expanded","false"),c(".local-my-course-"+t+".cat-"+t+"-"+r).slideDown("normal"),c("#local-my-cathandle-"+t+"-"+r+" > h3 > a").attr("aria-expanded","true")),!1},toggle_modality:function(){var a=c(this),t=a.attr("id").replace("local-my-static-select-","local-my-static-modal-");c(".local-my-statictext-modals").addClass("local-my-hide"),c("#"+t+"-"+a.val()).removeClass("local-my-hide")},toggle_detail:function(a){a.stopPropagation(),a.preventDefault();var a=c(this),t="#details-indicators-"+a.attr("id").replace("detail-handle-","");return"none"===c(t).css("display")?(c(t).css("display","flex"),a.attr("aria-expanded",!0),a.children("i").removeClass("fa-caret-down"),a.children("i").addClass("fa-caret-up")):(c(t).css("display","none"),a.attr("aria-expanded",!1),a.children("i").removeClass("fa-caret-up"),a.children("i").addClass("fa-caret-down")),!1},global_area_ctl:function(a){var t,e=c(this),a=(a.stopPropagation(),a.preventDefault(),e.attr("id").match(/local-my-cats-([^-]+)-([^-]+)$/));if(a)return e=a[1],a=a[2],t="","collapseall"==e?(c(".local-my-course-"+a).addClass("collapsed"),c(".local-my-cat-collapse-"+a+" > h3 > button > img").each(function(a,t){var e=(e=t.src).replace("expanded","collapsed");t.src=e}),t=d.wwwroot+"/local/my/ajax/stateregister.php?",t=(t+="item="+a)+"&catids="+c("#local-my-areacategories-"+a).html(),c.get(t+="&what=collapseall")):(c(".local-my-course-"+a).removeClass("collapsed"),c(".local-my-cat-collapse-"+a+" > h3 > button > img").each(function(a,t){var e=(e=t.src).replace("collapsed","expanded");t.src=e}),t=d.wwwroot+"/local/my/ajax/stateregister.php?",t=(t+="item="+a)+"&catids="+c("#local-my-areacategories-"+a).html(),c.get(t+="&what=expandall")),!1},sektor:function(a){"color"in a||(a.color="#bb3030"),"circlecolor"in a||(a.circlecolor="#ddd"),n.debug("Sektor refresh on "+a.id);new Sektor(a.id,{size:a.size,stroke:0,arc:!1,angle:a.angle,sectorColor:a.color,circleColor:a.circlecolor,fillCircle:!0})},add_to_favorites:function(){var a=c(this),t=a.attr("data-course"),e=a.hasClass("light"),r=d.wwwroot+"/local/my/ajax/service.php",e=(r=r+"?what=addtofavorites"+("&courseid="+t),a.removeClass("fa-star-o"),a.addClass("fa-star"),e&&(a.removeClass("add-to-favorites-handle"),a.addClass("remove-from-favorites-handle")),n.debug("Adding course "+t+" to favorites"),c.get(r),c(".favorite-courses"));e.length&&e.each(function(){c(this).children(".reload-areas").trigger("click")})},remove_from_favorites:function(){var a=c(this),t=a.attr("data-course"),e=a.hasClass("light"),r=d.wwwroot+"/local/my/ajax/service.php",r=(r=r+"?what=removefromfavorites"+("&courseid="+t),n.debug("Removing course "+t+" from favorites"),c.get(r),c('.icon-favorite[data-course="'+t+'"]').removeClass("fa-star"),c('.icon-favorite[data-course="'+t+'"]').addClass("fa-star-o"),e&&(a.removeClass("fa-star"),a.addClass("fa-star-o"),a.removeClass("remove-from-favorites-handle"),a.addClass("add-to-favorites-handle")),c(".favorite-courses"));r.length&&r.each(function(){c(this).children(".reload-areas").trigger("click")})},refresh_course_list:function(){var a,t=c(this),e=t.attr("data-uid"),r=t.attr("data-view"),o=t.attr("data-widget"),l=(n.debug("Activating sort/filter/display option on "+e),c(".course-filters-"+e+".active")),s=(s=(s=d.wwwroot+"/local/my/ajax/service.php")+"?what=getcourses"+("&widget="+o))+("&uid="+e)+("&view="+r);if(t.attr("data-sort")?s+="&sort="+t.attr("data-sort"):(r=c(".course-sort-"+e+".active"))&&(s+="&sort="+r.attr("data-sort")),t.attr("data-display")?s+="&display="+t.attr("data-display"):(r=c(".course-display-"+e+".active"))&&(s+="&display="+r.attr("data-display")),t.attr("data-time")?s+="&schedule="+t.attr("data-time"):(r=c(".course-time-"+e+".active"))&&(s+="&schedule="+r.attr("data-time")),t.attr("data-filter")&&(a=t.attr("data-filter"),s+="&"+t.attr("data-filter")+"="+t.attr("data-filter-value")),l.length)for(var i in l)i.attr("data-filter")!=a&&(s+="&"+i.attr("data-filter")+"="+i.attr("data-filter-value"));h.usereloadwaiter&&c("#content-"+e).html('<img src="'+d.wwwroot+'/pix/i/loading.gif">'),c.get(s,function(a){c("#area-courses-"+e).html(a.html),c("#block_"+o+"-"+e+" .filter-states").html(a.filterstates)},"json")}};return h});