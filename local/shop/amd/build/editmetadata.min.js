define(["jquery","core/log"],function(s,m){var c={init:function(){s('input[name="editextradata"]').bind("click",this.openeditmodal),s('input[name="editproductiondata"]').bind("click",this.openeditmodal),s('input[name="edithandlerparams"]').bind("click",this.openeditmodal)},parsevalues:function(a,t){var e,n,d,i=[];if("json"===t)i=JSON.parse(a);else for(n in d=a.split("&"))i[(e=d[n].split("="))[0]]=e[1];return i},recombinevalues:function(a,t){var e,n=[];if("json"===t)return JSON.stringify(a);for(e in a)n.push(e+"="+a[e]);return n.join("&")},openeditmodal:function(a){a.stopPropagation(),a.preventDefault(),m.debug("Opening modal for metadatas.");var t,e,n,d,i,a=s(this),o=s("#metadata-edit-modal-form"),p=s("#metadata-edit-modal-container"),a=s("[data-edithandle="+a.attr("id")+"]"),l=a.attr("data-format"),r=c.parsevalues(a.val(),l);for(i in m.debug("Detected format is "+l+"."),r)t=s("<div/>",{class:"mtd-row"}),e=s('<div class="mtd-name">'+i+"</div>"),(n=s("<div/>")).append(s("<input/>",{type:"text",size:80,value:r[i],placeholder:i,name:i})),t.append(e).append(n),o.append(t);t=s("<div/>",{class:"mtd-row"}),(e=s("<div/>")).append(s("<input/>",{type:"text",value:"",placeholder:"New key",name:"newkey"})),(n=s("<div/>")).append(s("<input/>",{type:"text",value:"",size:80,placeholder:"New value",name:"newval"})),t.append(e).append(n),o.append(t),t=s("<div/>",{class:"mtd-row"}),(d=s("<div/>")).append(s("<input/>",{type:"button",id:"mtd-close",value:"Save","data-format":l,"data-for":a.attr("id"),class:"btn btn-primary"})),d.append(s("<input/>",{type:"button",id:"mtd-cancel",value:"Cancel","data-format":l,"data-for":a.attr("id"),class:"btn btn-primary"})),t.append(s("<div/>")).append(d),o.append(t),s("#mtd-close").bind("click",c.closeeditmodal),s("#mtd-cancel").bind("click",c.canceleditmodal),p.css("display","block")},canceleditmodal:function(a){var t=s("#metadata-edit-modal-container"),e=s("#metadata-edit-modal-form");a.stopPropagation(),a.preventDefault(),e.empty(),t.css("display","none")},closeeditmodal:function(a){a.stopPropagation(),a.preventDefault();var t,e,a=s(this),n=s("#metadata-edit-modal-container"),d=s("#metadata-edit-modal-form"),i=a.attr("data-format"),o=s('input[type="text"]',d),p=new Object;o.each(function(){"newkey"===s(this).attr("name")?t=s(this).val():"newval"===s(this).attr("name")?e=s(this).val():p[s(this).attr("name")]=s(this).val()}),t&&(p[t]=e),s("#"+a.attr("data-for")).val(c.recombinevalues(p,i)),d.empty(),n.css("display","none")}};return c});