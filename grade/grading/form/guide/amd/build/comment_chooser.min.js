define(["jquery","core/templates","core/notification","core/yui"],function(d,o,t){return{initialise:function(r,e,a,l){function n(){o.render("gradingform_guide/comment_chooser",{criterionId:r,comments:l}).done(function(e){var n,o,t,i,c;e=e,n=l,o="<label>"+M.util.get_string("insertcomment","gradingform_guide")+"</label>",i='<button id="'+(t="comment-chooser-"+r+"-cancel")+'">'+M.util.get_string("cancel","moodle")+"</button>",c=new M.core.dialogue({modal:!0,headerContent:o,bodyContent:e,footerContent:i,focusAfterHide:"#"+a,id:"comments-chooser-dialog-"+r}),d("#"+t).click(function(){c.hide()}),d.each(n,function(e,o){var n="#comment-option-"+r+"-"+o.id;d(n).click(function(){var e=d("#"+a),n=e.val();""!==d.trim(n)&&(n+="\n"),n+=o.description,e.val(n),c.hide()}),d(document).off("keypress",n).on("keypress",n,function(){var e=event.which||event.keyCode;13!=e&&32!=e||d(n).click()})}),c.after("visibleChange",function(e){e.prevVal&&!e.newVal&&this.destroy()},c),c.show()}).fail(t.exception)}d("#"+e).click(function(e){e.preventDefault(),n()})}}});