define(["core/yui","jquery","core/log"],function(r,o,i){var n={types:{success:"core/notification_success",info:"core/notification_info",warning:"core/notification_warning",error:"core/notification_error"},fieldName:"user-notifications",fetchNotifications:function(){require(["core/ajax"],function(e){e.call([{methodname:"core_fetch_notifications",args:{contextid:n.contextid}}])[0].done(n.addNotifications)})},addNotifications:function(e){o.each(e=e||[],function(e,t){n.renderNotification(t.template,t.variables)})},setupTargetRegion:function(){var e=o("#"+n.fieldName);if(e.length)return!1;var t=o("<span>").attr("id",n.fieldName);return((e=o("#region-main")).length||(e=o('[role="main"]')).length?e:e=o("body")).prepend(t)},addNotification:function(e){var t=n.types.error;return(e=o.extend({closebutton:!0,announce:!0,type:"error"},e)).template?(t=e.template,delete e.template):e.type&&(void 0!==n.types[e.type]&&(t=n.types[e.type]),delete e.type),n.renderNotification(t,e)},renderNotification:function(e,t){void 0!==t.message&&t.message?require(["core/templates"],function(i){i.render(e,t).done(function(e,t){o("#"+n.fieldName).prepend(e),i.runTemplateJS(t)}).fail(n.exception)}):i.debug("Notification received without content. Skipping.")},alert:function(e,t,i){r.use("moodle-core-notification-alert",function(){new M.core.alert({title:e,message:t,yesLabel:i}).show()})},confirm:function(t,i,o,n,c,a){r.use("moodle-core-notification-confirm",function(){var e=new M.core.confirm({title:t,question:i,yesLabel:o,noLabel:n});e.on("complete-yes",function(){c()}),a&&e.on("complete-no",function(){a()}),e.show()})},exception:function(e){var t,i;void 0===e.stack&&(e.stack=""),e.debuginfo&&(e.stack+=e.debuginfo+"\n"),!e.backtrace&&e.stacktrace&&(e.backtrace=e.stacktrace),e.backtrace&&(e.stack+=e.backtrace,t=e.backtrace.match(/line ([^ ]*) of/),i=e.backtrace.match(/ of ([^:]*): /),t&&t[1]&&(e.lineNumber=t[1]),i&&i[1]&&(e.fileName=i[1],30<e.fileName.length&&(e.fileName="..."+e.fileName.substr(e.fileName.length-27)))),void 0===e.name&&e.errorcode&&(e.name=e.errorcode),r.use("moodle-core-notification-exception",function(){new M.core.exception(e).show()})}};return{init:function(e,t){n.contextid=e,n.setupTargetRegion(),n.addNotifications(t),n.fetchNotifications()},fetchNotifications:n.fetchNotifications,addNotification:n.addNotification,alert:n.alert,confirm:n.confirm,exception:n.exception}});