define(["jquery","core/custom_interaction_events","core/paged_content_events","core/str","core/pubsub"],function(f,c,T,E,p){function A(a,t){return a.find(b.PAGE_ITEM+'[data-page-number="'+t+'"]')}var b={ROOT:'[data-region="paging-bar"]',PAGE:"[data-page]",PAGE_ITEM:'[data-region="page-item"]',PAGE_LINK:'[data-region="page-link"]',FIRST_BUTTON:'[data-control="first"]',LAST_BUTTON:'[data-control="last"]',NEXT_BUTTON:'[data-control="next"]',PREVIOUS_BUTTON:'[data-control="previous"]'},l=function(a,t){a.attr("data-last-page-number",t)},m=function(a){return parseInt(a.attr("data-last-page-number"),10)},v=function(a){return parseInt(a.attr("data-active-page-number"),10)},_=function(a,t){a.attr("data-active-page-number",t)},I=function(a,t){if(null!=t.attr("data-page"))return parseInt(t.attr("data-page-number"),10);var e=1,n=null;switch(t.attr("data-control")){case"first":e=1;break;case"last":e=m(a);break;case"next":var n=v(a),r=m(a),e=!r||n&&n<r?n+1:r;break;case"previous":e=(n=v(a))&&1<n?n-1:1;break;default:e=1}return parseInt(e,10)},u=function(a,t){a.attr("data-items-per-page",t)},N=function(a){a.removeClass("hidden")},O=function(a){a.addClass("hidden")},g=function(a){var t=a.find(b.NEXT_BUTTON),a=a.find(b.LAST_BUTTON);t.addClass("disabled"),t.attr("aria-disabled",!0),a.addClass("disabled"),a.attr("aria-disabled",!0)},P=function(a){var t=a.find(b.PREVIOUS_BUTTON),a=a.find(b.FIRST_BUTTON);t.addClass("disabled"),t.attr("aria-disabled",!0),a.addClass("disabled"),a.attr("aria-disabled",!0)},S=function(a){return a.attr("data-aria-label-components-pagination-item").split(",").map(function(a){return a.trim()})},U=function(a){return a.attr("data-aria-label-components-pagination-active-item").split(",").map(function(a){return a.trim()})},C=function(a,t,l){var e,n,r,i,s,d=m(a),o=t==v(a),c=parseInt(a.attr("data-items-per-page"),10),u=(t-1)*c;o||(a.find(b.PAGE_ITEM).removeClass("active").removeAttr("aria-current"),(o=A(a,t)).addClass("active"),o.attr("aria-current",!0),_(a,t)),d&&d<=t?g(a):(d=(o=a).find(b.NEXT_BUTTON),o=o.find(b.LAST_BUTTON),d.removeClass("disabled"),d.removeAttr("aria-disabled"),o.removeClass("disabled"),o.removeAttr("aria-disabled")),1<t?(o=(d=a).find(b.PREVIOUS_BUTTON),d=d.find(b.FIRST_BUTTON),o.removeClass("disabled"),o.removeAttr("aria-disabled"),d.removeClass("disabled"),d.removeAttr("aria-disabled")):P(a),n=S(e=a),r=U(e),i=v(e),s=e.find(b.PAGE_ITEM),o=s.map(function(a,t){t=f(t);t=I(e,t);return t===i?{key:r[0],component:r[1],param:t}:{key:n[0],component:n[1],param:t}}),E.get_strings(o).then(function(e){return s.each(function(a,t){t=f(t);a=e[a];t.attr("aria-label",a),t.find(b.PAGE_LINK).attr("aria-label",a)}),e}).catch(function(){}),p.publish(l+T.SHOW_PAGES,[{pageNumber:t,limit:c,offset:u}])};return{init:function(a,t){var e,n,r,i,s,d,o=(a=f(a)).find(b.PAGE);o=o,_(e=a,n=0),o.each(function(a,t){a+=1;(t=f(t)).attr("data-page-number",a),n++,t.hasClass("active")&&_(e,a)}),l(e,n),i=t,s=(r=a).attr("data-ignore-control-while-loading"),d=!1,""==s&&(s=!0),c.define(r,[c.events.activate]),r.on(c.events.activate,b.PAGE_ITEM,function(a,t){t.originalEvent.preventDefault(),t.originalEvent.stopPropagation(),s&&d||((t=f(a.target).closest(b.PAGE_ITEM)).hasClass("disabled")||(a=I(r,t),C(r,a,i),d=!0))}),p.subscribe(i+T.ALL_ITEMS_LOADED,function(a){d=!1;var t=m(r);(!t||a<t)&&l(r,a),1===a&&r.attr("data-hide-control-on-single-page")?(O(r),g(r),P(r)):(N(r),g(r))}),p.subscribe(i+T.PAGES_SHOWN,function(){d=!1}),p.subscribe(i+T.SET_ITEMS_PER_PAGE_LIMIT,function(a){u(r,a),l(r,0),_(r,0),N(r),C(r,1,i)}),!function(a){a=v(a);return!isNaN(a)&&0!=a}(a)?a.find(b.NEXT_BUTTON).click():(o=v(a),A(a,o).click(),1==o&&P(a))},showPage:C,rootSelector:b.ROOT}});