define(["jquery","core/autoscroll"],function(c,r){var d={eventCaptureOptions:{passive:!1,capture:!0},dragProxy:null,onMove:null,onDrop:null,initialPosition:null,initialX:null,initialY:null,touching:null,prepare:function(e){return e.preventDefault(),("touchstart"===e.type?null===d.touching&&0<e.changedTouches.length:1===e.which)?((e=d.getEventXY(e)).start=!0,e):{start:!1}},start:function(e,t,n,o){var a=d.getEventXY(e);switch(d.initialX=a.x,d.initialY=a.y,d.initialPosition=t.offset(),d.dragProxy=t,d.onMove=n,d.onDrop=o,e.type){case"mousedown":d.addEventSpecial("mousemove",d.mouseMove),d.addEventSpecial("mouseup",d.mouseUp);break;case"touchstart":d.addEventSpecial("touchend",d.touchEnd),d.addEventSpecial("touchcancel",d.touchEnd),d.addEventSpecial("touchmove",d.touchMove),d.touching=e.changedTouches[0].identifier;break;default:throw new Error("Unexpected event type: "+e.type)}r.start(d.scroll)},addEventSpecial:function(t,n){try{window.addEventListener(t,n,d.eventCaptureOptions)}catch(e){d.eventCaptureOptions=!0,window.addEventListener(t,n,d.eventCaptureOptions)}},getEventXY:function(e){switch(e.type){case"touchstart":return{x:e.changedTouches[0].pageX,y:e.changedTouches[0].pageY};case"mousedown":return{x:e.pageX,y:e.pageY};default:throw new Error("Unexpected event type: "+e.type)}},touchMove:function(e){e.preventDefault();for(var t=0;t<e.changedTouches.length;t++)e.changedTouches[t].identifier===d.touching&&d.handleMove(e.changedTouches[t].pageX,e.changedTouches[t].pageY)},mouseMove:function(e){d.handleMove(e.pageX,e.pageY)},handleMove:function(e,t){var n=d.dragProxy.offset(),o=n.top-parseInt(d.dragProxy.css("top")),n=n.left-parseInt(d.dragProxy.css("left")),a=c(document).height()-d.dragProxy.outerHeight()-o,r=c(document).width()-d.dragProxy.outerWidth()-n,i=-n,u=d.initialPosition,a={top:Math.max(-o,Math.min(a,u.top+(t-d.initialY)-o)),left:Math.max(i,Math.min(r,u.left+(e-d.initialX)-n))};d.dragProxy.css(a),d.onMove(e,t,d.dragProxy)},touchEnd:function(e){e.preventDefault();for(var t=0;t<e.changedTouches.length;t++)e.changedTouches[t].identifier===d.touching&&d.handleEnd(e.changedTouches[t].pageX,e.changedTouches[t].pageY)},mouseUp:function(e){d.handleEnd(e.pageX,e.pageY)},handleEnd:function(e,t){null!==d.touching?(window.removeEventListener("touchend",d.touchEnd,d.eventCaptureOptions),window.removeEventListener("touchcancel",d.touchEnd,d.eventCaptureOptions),window.removeEventListener("touchmove",d.touchMove,d.eventCaptureOptions),d.touching=null):(window.removeEventListener("mousemove",d.mouseMove,d.eventCaptureOptions),window.removeEventListener("mouseup",d.mouseUp,d.eventCaptureOptions)),r.stop(),d.onDrop(e,t,d.dragProxy)},scroll:function(e){var t=c(document).height()-d.dragProxy.outerHeight(),n=d.dragProxy.offset();n.top=Math.min(t,n.top+e),d.dragProxy.css(n)}};return{prepare:d.prepare,start:d.start}});