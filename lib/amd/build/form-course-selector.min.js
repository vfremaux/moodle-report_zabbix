define(["core/ajax","jquery"],function(o,n){return{processResults:function(e,r){for(var a=[],s=0,i=String(n(e).data("exclude")).split(","),s=0;s<r.courses.length;s++)-1===i.indexOf(String(r.courses[s].id))&&a.push({value:r.courses[s].id,label:r.courses[s].displayname});return a},transport:function(e,a,s,r){var e=n(e),i=""!==(i=e.data("requiredcapabilities")).trim()?i.split(","):[],t=e.data("limittoenrolled"),e=e.data("includefrontpage"),i=[{methodname:"core_course_search_courses",args:{criterianame:"search",criteriavalue:a=void 0===a?"":a,page:0,perpage:100,requiredcapabilities:i,limittoenrolled:t}}];e&&i.push({methodname:"core_course_get_courses",args:{options:{ids:[e]}}}),t=o.call(i),n.when.apply(n.when,t).done(function(e,r){r&&1==r.length&&(r=r.pop(),(""===a||-1<r.fullname.toUpperCase().indexOf(a.toUpperCase())||-1<r.shortname.toUpperCase().indexOf(a.toUpperCase()))&&e.courses.splice(0,0,r)),s(e)}).fail(r)}}});