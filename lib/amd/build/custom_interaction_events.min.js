define(["jquery","core/key_codes"],function(r,t){function c(e){return e.shiftKey||e.metaKey||e.altKey||e.ctrlKey}function l(e,o){var t="";if(!o.hasOwnProperty("originalEvent"))return t=""+e+o.type+o.timeStamp,i.hasOwnProperty(t)||(i[t]=!0,r(o.target).trigger(e,[{originalEvent:o}])),0;o.originalEvent.hasOwnProperty(t="triggeredCustom_"+e)||(o.originalEvent[t]=!0,r(o.target).trigger(e,[{originalEvent:o}]))}function n(e,o,t){e.off("keydown."+o).on("keydown."+o,function(e){c(e)||e.keyCode==t&&l(o,e)})}var a={activate:"cie:activate",keyboardActivate:"cie:keyboardactivate",escape:"cie:escape",down:"cie:down",up:"cie:up",home:"cie:home",end:"cie:end",next:"cie:next",previous:"cie:previous",asterix:"cie:asterix",scrollLock:"cie:scrollLock",scrollTop:"cie:scrollTop",scrollBottom:"cie:scrollBottom",ctrlPageUp:"cie:ctrlPageUp",ctrlPageDown:"cie:ctrlPageDown",enter:"cie:enter"},i={},o=function(e){e.off("click.cie.activate").on("click.cie.activate",function(e){l(a.activate,e)}),e.off("keydown.cie.activate").on("keydown.cie.activate",function(e){c(e)||e.keyCode!=t.enter&&e.keyCode!=t.space||l(a.activate,e)})},s=function(e){e.off("keydown.cie.keyboardactivate").on("keydown.cie.keyboardactivate",function(e){c(e)||e.keyCode!=t.enter&&e.keyCode!=t.space||l(a.keyboardActivate,e)})},u=function(e){n(e,a.escape,t.escape)},f=function(e){n(e,a.down,t.arrowDown)},p=function(e){n(e,a.up,t.arrowUp)},d=function(e){n(e,a.home,t.home)},g=function(e){n(e,a.end,t.end)},v=function(e){var o="rtl"==r("html").attr("dir")?t.arrowLeft:t.arrowRight;n(e,a.next,o)},w=function(e){var o="rtl"==r("html").attr("dir")?t.arrowRight:t.arrowLeft;n(e,a.previous,o)},y=function(e){n(e,a.asterix,t.asterix)},k=function(o){o.off("scroll.cie.scrollTop").on("scroll.cie.scrollTop",function(e){0===o.scrollTop()&&l(a.scrollTop,e)})},h=function(c){c.off("scroll.cie.scrollBottom").on("scroll.cie.scrollBottom",function(e){var o=c.scrollTop(),t=c.innerHeight();c[0].scrollHeight<=o+t&&l(a.scrollBottom,e)})},m=function(i){i.off("DOMMouseScroll.cie.DOMMouseScrollLock mousewheel.cie.mousewheelLock").on("DOMMouseScroll.cie.DOMMouseScrollLock mousewheel.cie.mousewheelLock",function(e){var o=i.scrollTop(),t=i[0].scrollHeight,c=i.height(),n="DOMMouseScroll"==e.type?-40*e.originalEvent.detail:e.originalEvent.wheelDelta,r=0<n;return!r&&t-c-o<-n?(i.scrollTop(t),e.stopPropagation(),e.preventDefault(),e.returnValue=!1,l(a.scrollLock,e),!1):!(r&&o<n)||(i.scrollTop(0),e.stopPropagation(),e.preventDefault(),e.returnValue=!1,l(a.scrollLock,e),!1)})},D=function(e){e.off("keydown.cie.ctrlpageup").on("keydown.cie.ctrlpageup",function(e){e.ctrlKey&&e.keyCode==t.pageUp&&l(a.ctrlPageUp,e)})},P=function(e){e.off("keydown.cie.ctrlpagedown").on("keydown.cie.ctrlpagedown",function(e){e.ctrlKey&&e.keyCode==t.pageDown&&l(a.ctrlPageDown,e)})},L=function(e){n(e,a.enter,t.enter)};return{define:function(c,n){var e;c=r(c),n=n||[],c.length&&n.length&&r.each(((e={})[a.activate]=o,e[a.keyboardActivate]=s,e[a.escape]=u,e[a.down]=f,e[a.up]=p,e[a.home]=d,e[a.end]=g,e[a.next]=v,e[a.previous]=w,e[a.asterix]=y,e[a.scrollLock]=m,e[a.scrollTop]=k,e[a.scrollBottom]=h,e[a.ctrlPageUp]=D,e[a.ctrlPageDown]=P,e[a.enter]=L,e),function(e,o){var t;e=e,(t=(t=n)||[]).length&&-1!==t.indexOf(e)&&o(c)})},events:a}});