define(["jquery","core/templates","core/notification","core/paged_content","core/paged_content_events","core/pubsub","core/ajax"],function(l,n,t,c,o,a,i){function p(){return{showitemsperpageselector:!1,itemsperpage:35,previous:!0,next:!0,activepagenumber:1,hidecontrolonsinglepage:!0,pages:[]}}function g(e){null===e&&(e=h);var r,n,t=p();return t.itemsperpage=(r=e,l.isArray(r)?((n=r.map(function(e){return"number"==typeof e?{value:e,active:!1}:e})).filter(function(e){return e.active}).length||(n[0].active=!0),n):r),t.showitemsperpageselector=l.isArray(e),t}function f(e,r){if(e){var n=r;null===n&&(n=u),l.isArray(n)&&(n=n[0]);for(var t,o,a=p(),i=(n=a.itemsperpage=n,o=1,o=0<(e=e)?(t=e%n)?(e-=t)/n+1:e/n:o),c=1;c<=i;c++){var s={number:c,page:""+c};1===c&&(s.active=!0),a.pages.push(s)}return a}return g(r)}function s(e,r,o,a){a=a||{};var i=l.Deferred(),e=d(e,r,a);return n.render(m.PAGED_CONTENT,e).then(function(e,r){var n=(e=l(e)).attr("id"),t=(a.hasOwnProperty("eventNamespace")&&(n=a.eventNamespace),e);c.init(t,o,n),P(n,a),i.resolve(e,r)}).fail(function(e){i.reject(e)}).fail(t.exception),i.promise()}var m={PAGED_CONTENT:"core/paged_content"},u=25,h=[25,50,100,0],v=3,d=function(e,r,n){var t={pagingbar:!1,pagingdropdown:!1,skipjs:!0,ignorecontrolwhileloading:!0,controlplacementbottom:!1};return n.hasOwnProperty("ignoreControlWhileLoading")&&(t.ignorecontrolwhileloading=n.ignoreControlWhileLoading),n.hasOwnProperty("controlPlacementBottom")&&(t.controlplacementbottom=n.controlPlacementBottom),n.hasOwnProperty("hideControlOnSinglePage")&&(t.hidecontrolonsinglepage=n.hideControlOnSinglePage),n.hasOwnProperty("ariaLabels")&&(t.arialabels=n.ariaLabels),n.hasOwnProperty("dropdown")&&n.dropdown?t.pagingdropdown=function(e,r){if(null===e&&(e=u),l.isArray(e))return{options:e};var n={options:[]},t=0,o=0,a=v;r.hasOwnProperty("maxPages")&&(a=r.maxPages);for(var i=1;i<=a;i++){var c=0,c=(i<=2?o=c=e:c=o*=2,{itemcount:c,content:t+=c});1===i&&(c.active=!0),n.options.push(c)}return n}(r,n):t.pagingbar=f(e,r),t},P=function(e,r){var n;r.hasOwnProperty("persistentLimitKey")&&a.subscribe(e+o.SET_ITEMS_PER_PAGE_LIMIT,(n=r.persistentLimitKey,function(e){i.call([{methodname:"core_user_update_user_preferences",args:{preferences:[{type:n,value:e}]}}])}))};return{create:function(e,r){return s(null,null,e,r)},createWithLimit:function(e,r,n){return s(null,e,r,n)},createWithTotalAndLimit:s,createFromStaticList:function(t,e,r,n){var o=t.length;return s(o,e,function(e){var n=[];return e.forEach(function(e){var r=e.offset,e=e.limit?r+e.limit:o,r=t.slice(r,e);n.push(r)}),r(n)},n=void 0===n?{}:n)},createFromAjax:s,resetLastPageNumber:function(e,r){a.publish(e+o.ALL_ITEMS_LOADED,r)}}});