define(["jquery"],function(s){function i(e,t){if(null==this)throw TypeError();var r=(e=String(e)).length;if((t=(t=t?Number(t):0)!=t?0:t)<=-1||r<=t)return"";var n,i=e.charCodeAt(t|=0),t=t+1,a=1;return a=55296<=i&&i<=56319&&t<r&&56320<=(n=e.charCodeAt(t))&&n<=57343?2:a}function h(e){for(var t=0,r=0;r<e.length;r+=i(e,r))t++;return t}function o(e,t){if(!e.length)return 0;for(var r=0,n=0;n++,(r+=i(e,r))<e.length&&n<t;);return r}var a=/(\s*\S+|\s)$/,d=/^(\S*)/,f=/\s/;return s.truncate=function(e,t){return s("<div></div>").append(e).truncate(t).html()},s.fn.truncate=function(e){s.isNumeric(e)&&(e={length:e});var l=s.extend({},s.truncate.defaults,e);return this.each(function(){var e,t,r=s(this),u=(l.noBreaks&&r.find("br").replaceWith(" "),l.ellipsis.length),n=r.text(),i=h(n),c=i-l.length+u;i<l.length||(l.stripTags&&r.text(n),l.words&&0<c&&(e=(t=n.slice(0,o(n,l.length-u)+1)).replace(a,""),e=h(e),t=!t.match(f),c=l.keepFirstWord&&0===e?i-h(d.exec(n)[0])-u:t&&0===e?i-l.length+u:i-e-1),(c=i<c?i-l.length:c)<0||!c&&!l.truncated||s.each(r.contents().get().reverse(),function(e,t){var r,n=s(t),i=n.text(),a=h(i);return a<=c?(l.truncated=!0,c-=a,void n.remove()):(3===t.nodeType?(r=0<=(r=a-c)?o(i,r):0,s(t.splitText(r)).replaceWith(l.ellipsis)):n.truncate(s.extend(l,{length:a-c+u})),!1)}))})},s.truncate.defaults={stripTags:!1,words:!1,keepFirstWord:!1,noBreaks:!1,length:1/0,ellipsis:"â€¦"},{truncate:s.truncate}});