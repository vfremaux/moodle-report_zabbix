define(["jquery","core/templates","core/notification","core/pubsub","core/paged_content_events"],function(s,r,l,d,v){var g={ROOT:'[data-region="page-container"]',PAGE_REGION:'[data-region="paged-content-page"]',ACTIVE_PAGE_REGION:'[data-region="paged-content-page"].active'},a="core/paged_content_page",e="core/overlay_loading",h=function(e,n){return e.find('[data-page="'+n+'"]')},E=function(o){var i=s.Deferred();return o.attr("aria-busy",!0),r.render(e,{visible:!0}).then(function(e){var n=s(e),t=setTimeout(function(){o.css("position","relative"),n.appendTo(o)},300);i.always(function(){clearTimeout(t),n.remove(),o.css("position",""),o.removeAttr("aria-busy")})}).fail(l.exception),i},_=function(t,e,o){var i=s.Deferred();return e.then(function(e,n){n=n||"",r.render(a,{page:o,content:e}).then(function(e){r.appendNodeContents(t,e,n);e=h(t,o);i.resolve(e)}).fail(function(e){i.reject(e)}).fail(l.exception)}).fail(function(e){i.reject(e)}).fail(l.exception),i.promise()};return{init:function(u,f,p){u=s(u),d.subscribe(f+v.SHOW_PAGES,function(e){var t,n,o,i,r,a,c;t=u,n=e,o=f,e=p,i=[],r=[],a=s.Deferred(),n.forEach(function(e){var n=e.pageNumber,n=h(t,n);n.length?i.push(n):r.push(e)}),r.length&&"function"==typeof e?(e=e(r,{allItemsLoaded:function(e){d.publish(o+v.ALL_ITEMS_LOADED,e)}}).map(function(e,n){return _(t,e,r[n].pageNumber)}),s.when.apply(s,e).then(function(){var e=Array.prototype.slice.call(arguments);a.resolve(e)}).fail(function(e){a.reject(e)}).fail(l.exception)):a.resolve([]),c=E(t),a.then(function(e){e=i.concat(e);t.find(g.PAGE_REGION).addClass("hidden"),e.forEach(function(e){e.removeClass("hidden")})}).then(function(){d.publish(o+v.PAGES_SHOWN,n)}).fail(l.exception).always(function(){c.resolve()})}),d.subscribe(f+v.SET_ITEMS_PER_PAGE_LIMIT,function(){u.empty()})},rootSelector:g.ROOT}});